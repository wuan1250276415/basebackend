# ================================================================================================
# Prometheus 配置文件
# ================================================================================================
#
# 用途：配置 Prometheus 监控数据采集规则
#
# ================================================================================================

# 全局配置
global:
  # 抓取间隔
  scrape_interval: 15s
  # 评估规则间隔
  evaluation_interval: 15s
  # 抓取超时
  scrape_timeout: 10s
  # 外部标签（会被添加到所有时间序列和告警中）
  external_labels:
    cluster: 'basebackend-dev'
    env: 'development'

# 告警管理器配置（可选）
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - 'alertmanager:9093'

# 规则文件加载（可选）
# rule_files:
#   - "/etc/prometheus/rules/*.yml"

# 抓取配置
scrape_configs:

  # ========================================
  # Prometheus 自身监控
  # ========================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # ========================================
  # BaseBackend Admin API 监控
  # ========================================
  - job_name: 'basebackend-admin-api'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 10s
    static_configs:
      - targets: ['host.docker.internal:8080']
        labels:
          service: 'admin-api'
          application: 'basebackend'
          module: 'admin'

  # ========================================
  # BaseBackend Gateway 监控
  # ========================================
  - job_name: 'basebackend-gateway'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 10s
    static_configs:
      - targets: ['host.docker.internal:8888']
        labels:
          service: 'gateway'
          application: 'basebackend'
          module: 'gateway'

  # ========================================
  # BaseBackend Demo API 监控
  # ========================================
  - job_name: 'basebackend-demo-api'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 10s
    static_configs:
      - targets: ['host.docker.internal:8081']
        labels:
          service: 'demo-api'
          application: 'basebackend'
          module: 'demo'

  # ========================================
  # MySQL Exporter (可选)
  # ========================================
  # - job_name: 'mysql'
  #   static_configs:
  #     - targets: ['mysql-exporter:9104']
  #       labels:
  #         service: 'mysql'

  # ========================================
  # Redis Exporter (可选)
  # ========================================
  # - job_name: 'redis'
  #   static_configs:
  #     - targets: ['redis-exporter:9121']
  #       labels:
  #         service: 'redis'

  # ========================================
  # RocketMQ Exporter (可选)
  # ========================================
  # - job_name: 'rocketmq'
  #   static_configs:
  #     - targets: ['rocketmq-exporter:5557']
  #       labels:
  #         service: 'rocketmq'

  # ========================================
  # Nacos 监控 (如果启用了 Actuator)
  # ========================================
  # - job_name: 'nacos'
  #   metrics_path: '/nacos/actuator/prometheus'
  #   static_configs:
  #     - targets: ['nacos:8848']
  #       labels:
  #         service: 'nacos'

# ========================================
# 服务发现配置 (可选 - Nacos)
# ========================================
# 如果启用 Nacos 服务发现，可以自动发现所有注册的服务
# - job_name: 'nacos-discovery'
#   nacos_sd_configs:
#     - server: 'nacos:8848'
#       namespace: 'public'
#       groups: ['DEFAULT_GROUP']
#   relabel_configs:
#     - source_labels: [__meta_nacos_service_name]
#       target_label: service
#     - source_labels: [__meta_nacos_metadata_management_port]
#       regex: '(.*)'
#       target_label: __address__
#       replacement: '$1'
#     - source_labels: [__address__]
#       regex: '([^:]+)(?::\d+)?'
#       target_label: __address__
#       replacement: '$1:${__meta_nacos_metadata_management_port}'
