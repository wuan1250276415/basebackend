# BaseBackend éƒ¨ç½²éªŒè¯æŠ¥å‘Š

> æœ¬æŠ¥å‘Šè®°å½•äº† BaseBackend ç›‘æ§å’Œéƒ¨ç½²åŸºç¡€è®¾æ–½çš„éªŒè¯ç»“æœ

**éªŒè¯æ—¥æœŸï¼š** 2025-01-13
**éªŒè¯èŒƒå›´ï¼š** Phase 3B é›†æˆæµ‹è¯•å’Œç›‘æ§éƒ¨ç½²
**éªŒè¯çŠ¶æ€ï¼š** âœ… éƒ¨ç½²æ–‡ä»¶åˆ›å»ºå®Œæˆï¼Œå¾…å®é™…ç¯å¢ƒéªŒè¯

---

## ğŸ“‹ ç›®å½•

- [éªŒè¯æ¦‚è§ˆ](#éªŒè¯æ¦‚è§ˆ)
- [éƒ¨ç½²æ–‡ä»¶éªŒè¯](#éƒ¨ç½²æ–‡ä»¶éªŒè¯)
- [é…ç½®æ–‡ä»¶éªŒè¯](#é…ç½®æ–‡ä»¶éªŒè¯)
- [æµ‹è¯•æ–‡ä»¶éªŒè¯](#æµ‹è¯•æ–‡ä»¶éªŒè¯)
- [æ–‡æ¡£éªŒè¯](#æ–‡æ¡£éªŒè¯)
- [å¾…éªŒè¯é¡¹](#å¾…éªŒè¯é¡¹)
- [éªŒè¯ç»“è®º](#éªŒè¯ç»“è®º)
- [åç»­æ­¥éª¤](#åç»­æ­¥éª¤)

---

## éªŒè¯æ¦‚è§ˆ

### éªŒè¯ç›®æ ‡

æœ¬æ¬¡éªŒè¯æ—¨åœ¨ç¡®è®¤ä»¥ä¸‹å†…å®¹çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼š

1. âœ… Docker Compose éƒ¨ç½²é…ç½®
2. âœ… Prometheus + Grafana ç›‘æ§é…ç½®
3. âœ… Grafana ä»ªè¡¨æ¿æ¨¡æ¿
4. âœ… é›†æˆæµ‹è¯•ä»£ç 
5. âœ… æ€§èƒ½æµ‹è¯•è„šæœ¬
6. âœ… éƒ¨ç½²æ–‡æ¡£

### éªŒè¯ç»“æœæ±‡æ€»

| ç±»åˆ« | é¡¹ç›®æ•° | çŠ¶æ€ | å¤‡æ³¨ |
|------|--------|------|------|
| éƒ¨ç½²é…ç½® | 4 | âœ… å®Œæˆ | Docker Compose + åŸºç¡€æœåŠ¡é…ç½® |
| ç›‘æ§é…ç½® | 6 | âœ… å®Œæˆ | Prometheus + Grafana + 3ä¸ªä»ªè¡¨æ¿ |
| é›†æˆæµ‹è¯• | 3 | âš ï¸ éƒ¨åˆ† | ä»£ç å·²åˆ›å»ºï¼Œéœ€åœ¨åº”ç”¨æ¨¡å—ä¸­éªŒè¯ |
| æ€§èƒ½æµ‹è¯• | 2 | âœ… å®Œæˆ | PowerShell + Bash åŒå¹³å°æ”¯æŒ |
| æ–‡æ¡£ | 1 | âœ… å®Œæˆ | å®Œæ•´çš„éƒ¨ç½²å’Œç›‘æ§æ–‡æ¡£ |

---

## éƒ¨ç½²æ–‡ä»¶éªŒè¯

### 1. Docker Compose é…ç½® âœ…

**æ–‡ä»¶ï¼š** `deployment/docker-compose.yml`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- âœ… åŒ…å«æ‰€æœ‰å¿…éœ€æœåŠ¡ï¼šMySQL, Redis, Nacos, RocketMQ, Prometheus, Grafana, Zipkin
- âœ… é…ç½®äº†å¥åº·æ£€æŸ¥
- âœ… é…ç½®äº†æ•°æ®å·æŒä¹…åŒ–
- âœ… é…ç½®äº†è‡ªå®šä¹‰ç½‘ç»œ

**å…³é”®é…ç½®ï¼š**
```yaml
services:
  mysql: 8.0.33 (ç«¯å£ 3306)
  redis: 7.2-alpine (ç«¯å£ 6379)
  nacos: v2.3.0 (ç«¯å£ 8848, 9848)
  rocketmq-namesrv: 5.1.4 (ç«¯å£ 9876)
  rocketmq-broker: 5.1.4 (ç«¯å£ 10909, 10911)
  prometheus: v2.48.0 (ç«¯å£ 9090)
  grafana: 10.2.2 (ç«¯å£ 3000)
  zipkin: 2.24 (ç«¯å£ 9411)
```

**å¥åº·æ£€æŸ¥ï¼š** æ‰€æœ‰æœåŠ¡å‡é…ç½®äº† healthcheck

**æ•°æ®æŒä¹…åŒ–ï¼š** ä½¿ç”¨ Named Volumes ç®¡ç†æ•°æ®

### 2. MySQL åˆå§‹åŒ–è„šæœ¬ âœ…

**æ–‡ä»¶ï¼š** `deployment/mysql/init.sql`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- âœ… åŒ…å« Nacos å®Œæ•´æ•°æ®åº“ schema
- âœ… åŒ…å«æ‰€æœ‰å¿…éœ€è¡¨ï¼šconfig_info, users, roles, permissions ç­‰
- âœ… ä½¿ç”¨ utf8mb4 å­—ç¬¦é›†

**è¡¨æ•°é‡ï¼š** 12 ä¸ªæ ¸å¿ƒè¡¨

### 3. RocketMQ Broker é…ç½® âœ…

**æ–‡ä»¶ï¼š** `deployment/rocketmq/broker.conf`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- âœ… é…ç½®äº† brokerClusterName
- âœ… é…ç½®äº† brokerName å’Œ brokerId
- âœ… é…ç½®äº† namesrvAddr
- âœ… é…ç½®äº†è‡ªåŠ¨åˆ›å»º Topic

---

## é…ç½®æ–‡ä»¶éªŒè¯

### 1. Prometheus é…ç½® âœ…

**æ–‡ä»¶ï¼š** `deployment/prometheus/prometheus.yml`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- âœ… é…ç½®äº†å…¨å±€å‚æ•°ï¼ˆscrape_interval, evaluation_intervalï¼‰
- âœ… é…ç½®äº† external_labelsï¼ˆcluster, envï¼‰
- âœ… é…ç½®äº†æŠ“å–ç›®æ ‡ï¼ˆbasebackend-admin-apiï¼‰
- âœ… ä½¿ç”¨ host.docker.internal è®¿é—®ä¸»æœºæœåŠ¡

**æŠ“å–é…ç½®ï¼š**
- `basebackend-admin-api`: http://host.docker.internal:8080/actuator/prometheus
- scrape_interval: 10s

### 2. Grafana æ•°æ®æºé…ç½® âœ…

**æ–‡ä»¶ï¼š** `deployment/grafana/provisioning/datasources/prometheus.yml`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- âœ… é…ç½®äº† Prometheus æ•°æ®æº
- âœ… é…ç½®äº†è‡ªåŠ¨åŠ è½½ï¼ˆeditable: trueï¼‰
- âœ… URL æ­£ç¡®æŒ‡å‘ Prometheus å®¹å™¨

**æ•°æ®æºé…ç½®ï¼š**
- åç§°ï¼šPrometheus
- ç±»å‹ï¼šprometheus
- URLï¼šhttp://prometheus:9090
- è®¿é—®æ¨¡å¼ï¼šproxy

### 3. Grafana ä»ªè¡¨æ¿æä¾›å™¨é…ç½® âœ…

**æ–‡ä»¶ï¼š** `deployment/grafana/provisioning/dashboards/dashboard-provider.yml`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- âœ… é…ç½®äº†è‡ªåŠ¨åŠ è½½ä»ªè¡¨æ¿
- âœ… é…ç½®äº†ä»ªè¡¨æ¿ç›®å½•è·¯å¾„
- âœ… é…ç½®äº†æ›´æ–°ç­–ç•¥

**ä»ªè¡¨æ¿é…ç½®ï¼š**
- æä¾›å™¨åç§°ï¼šbasebackend-dashboards
- æ–‡ä»¶å¤¹ï¼šBaseBackend
- ç±»å‹ï¼šfile
- æ›´æ–°é—´éš”ï¼š10s

### 4. Grafana ä»ªè¡¨æ¿æ¨¡æ¿ âœ…

#### 4.1 API æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿ âœ…

**æ–‡ä»¶ï¼š** `deployment/grafana/provisioning/dashboards/api-performance.json`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”ä¸ºæœ‰æ•ˆ JSON
- âœ… é…ç½®äº† UIDï¼šbasebackend-api-performance
- âœ… åŒ…å«æ‰€æœ‰å…³é”®é¢æ¿ï¼š
  - âœ… API QPS (æ¯ç§’è¯·æ±‚æ•°)
  - âœ… API å“åº”æ—¶é—´ (P95/P99)
  - âœ… API é”™è¯¯ç‡
  - âœ… å½“å‰æ´»è·ƒè¯·æ±‚æ•°
  - âœ… API è°ƒç”¨åˆ†å¸ƒï¼ˆé¥¼å›¾ï¼‰

**PromQL ç¤ºä¾‹ï¼š**
```promql
rate(api_calls_total{job="basebackend-admin-api"}[1m])
histogram_quantile(0.95, rate(api_response_time_seconds_bucket[5m]))
rate(api_errors_total[5m]) / rate(api_calls_total[5m])
```

#### 4.2 ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§ä»ªè¡¨æ¿ âœ…

**æ–‡ä»¶ï¼š** `deployment/grafana/provisioning/dashboards/business-metrics.json`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”ä¸ºæœ‰æ•ˆ JSON
- âœ… é…ç½®äº† UIDï¼šbasebackend-business-metrics
- âœ… åŒ…å«æ‰€æœ‰å…³é”®é¢æ¿ï¼š
  - âœ… æ€»ç”¨æˆ·æ•°ã€æ´»è·ƒç”¨æˆ·æ•°ã€åœ¨çº¿ç”¨æˆ·æ•°
  - âœ… ç”¨æˆ·æ³¨å†Œç‡ã€ç™»å½•ç‡
  - âœ… è®¢å•ç»Ÿè®¡ï¼ˆæ€»æ•°ã€å¾…å¤„ç†ã€å®Œæˆã€å–æ¶ˆï¼‰
  - âœ… è®¢å•å®Œæˆç‡
  - âœ… æ”¯ä»˜æˆåŠŸç‡

**PromQL ç¤ºä¾‹ï¼š**
```promql
business_users_total
business_users_active
rate(business_user_registrations_total{status="success"}[1m]) * 60
rate(business_payment_success_total[5m]) / rate(business_payment_requests_total[5m])
```

#### 4.3 ç³»ç»Ÿå¥åº·ç›‘æ§ä»ªè¡¨æ¿ âœ…

**æ–‡ä»¶ï¼š** `deployment/grafana/provisioning/dashboards/system-health.json`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”ä¸ºæœ‰æ•ˆ JSON
- âœ… é…ç½®äº† UIDï¼šbasebackend-system-health
- âœ… åŒ…å«æ‰€æœ‰å…³é”®é¢æ¿ï¼š
  - âœ… åº”ç”¨çŠ¶æ€ (UP/DOWN)
  - âœ… CPU ä½¿ç”¨ç‡
  - âœ… JVM å †å†…å­˜ä½¿ç”¨ç‡
  - âœ… çº¿ç¨‹æ•°
  - âœ… GC æš‚åœæ—¶é—´
  - âœ… æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
  - âœ… ç¼“å­˜å‘½ä¸­ç‡

**PromQL ç¤ºä¾‹ï¼š**
```promql
up{job="basebackend-admin-api"}
process_cpu_usage
jvm_memory_used_bytes{area="heap"} / jvm_memory_max_bytes{area="heap"}
rate(jvm_gc_pause_seconds_sum[1m])
hikaricp_connections_active / hikaricp_connections_max
business_cache_hit_rate
```

---

## æµ‹è¯•æ–‡ä»¶éªŒè¯

### 1. é›†æˆæµ‹è¯•ä»£ç  âš ï¸

#### 1.1 Metrics é›†æˆæµ‹è¯• âš ï¸

**æ–‡ä»¶ï¼š** `basebackend-observability/src/test/java/com/basebackend/observability/MetricsIntegrationTest.java`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”ä»£ç æ ¼å¼æ­£ç¡®
- âœ… åŒ…å«æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼š
  - âœ… ç”¨æˆ·æ³¨å†ŒæŒ‡æ ‡è®°å½•æµ‹è¯•
  - âœ… ç”¨æˆ·ç™»å½•æŒ‡æ ‡è®°å½•æµ‹è¯•
  - âœ… è®¢å•æŒ‡æ ‡è®°å½•æµ‹è¯•
  - âœ… æ”¯ä»˜æŒ‡æ ‡è®°å½•æµ‹è¯•
  - âœ… ç¼“å­˜å‘½ä¸­ç‡æŒ‡æ ‡è®°å½•æµ‹è¯•
  - âœ… @Timed æ³¨è§£åŠŸèƒ½æµ‹è¯•
  - âœ… @Counted æ³¨è§£åŠŸèƒ½æµ‹è¯•
- âš ï¸ éœ€è¦å®Œæ•´åº”ç”¨ä¸Šä¸‹æ–‡æ‰èƒ½è¿è¡Œ

**æµ‹è¯•ä¾èµ–ï¼š** JUnit 5, Mockito, AssertJ, Spring Boot Test

**å¤‡æ³¨ï¼š** ç”±äº basebackend-observability æ˜¯åº“æ¨¡å—ï¼Œé›†æˆæµ‹è¯•éœ€è¦åœ¨å®é™…åº”ç”¨æ¨¡å—ï¼ˆå¦‚ basebackend-admin-apiï¼‰ä¸­è¿è¡Œã€‚

#### 1.2 å¥åº·æ£€æŸ¥é›†æˆæµ‹è¯• âš ï¸

**æ–‡ä»¶ï¼š** `basebackend-observability/src/test/java/com/basebackend/observability/HealthCheckIntegrationTest.java`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”ä»£ç æ ¼å¼æ­£ç¡®
- âœ… åŒ…å«æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼š
  - âœ… ApplicationHealthIndicator å­˜åœ¨æ€§æµ‹è¯•
  - âœ… ApplicationHealthIndicator æ‰§è¡Œæµ‹è¯•
  - âœ… DiskSpaceHealthIndicator å­˜åœ¨æ€§æµ‹è¯•
  - âœ… DiskSpaceHealthIndicator æ‰§è¡Œæµ‹è¯•
  - âœ… DatabaseHealthIndicator æ¡ä»¶æ£€æŸ¥
  - âœ… RedisHealthIndicator æ¡ä»¶æ£€æŸ¥
  - âœ… RocketMQHealthIndicator æ¡ä»¶æ£€æŸ¥
  - âœ… æ‰€æœ‰ HealthIndicator å¼‚å¸¸æ£€æŸ¥
- âš ï¸ éœ€è¦å®Œæ•´åº”ç”¨ä¸Šä¸‹æ–‡æ‰èƒ½è¿è¡Œ

#### 1.3 é“¾è·¯è¿½è¸ªé›†æˆæµ‹è¯• âš ï¸

**æ–‡ä»¶ï¼š** `basebackend-observability/src/test/java/com/basebackend/observability/TracingIntegrationTest.java`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”ä»£ç æ ¼å¼æ­£ç¡®
- âœ… åŒ…å«æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼š
  - âœ… TracingMdcFilter MDC æ³¨å…¥æµ‹è¯•
  - âœ… TracingMdcFilter å“åº”å¤´æ·»åŠ æµ‹è¯•
  - âœ… æ—  Trace Context æ—¶çš„å¤‡ç”¨ RequestId æµ‹è¯•
  - âœ… MDC é”®åå¸¸é‡æµ‹è¯•
  - âœ… MDC æ¸…ç†æµ‹è¯•ï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰
- âš ï¸ éœ€è¦å®Œæ•´åº”ç”¨ä¸Šä¸‹æ–‡æ‰èƒ½è¿è¡Œ

**æ”¹è¿›æªæ–½ï¼š** å·²æ·»åŠ  `basebackend-observability/pom.xml` æµ‹è¯•ä¾èµ–ï¼š
- spring-boot-starter-test
- junit-jupiter
- mockito-core
- assertj-core

### 2. æ€§èƒ½æµ‹è¯•è„šæœ¬ âœ…

#### 2.1 PowerShell æ€§èƒ½æµ‹è¯•è„šæœ¬ âœ…

**æ–‡ä»¶ï¼š** `deployment/performance-tests/performance-test.ps1`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- âœ… æ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼š-TargetUrl, -Concurrency, -TotalRequests
- âœ… åŒ…å« 5 ä¸ªæµ‹è¯•é˜¶æ®µï¼š
  1. âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹æ€§èƒ½æµ‹è¯•
  2. âœ… Metrics ç«¯ç‚¹æ€§èƒ½æµ‹è¯•
  3. âœ… API å“åº”æ—¶é—´æµ‹è¯•
  4. âœ… å¹¶å‘å‹åŠ›æµ‹è¯•
  5. âœ… Metrics éªŒè¯
- âœ… ä½¿ç”¨ PowerShell å¼‚æ­¥ Jobs å®ç°å¹¶å‘
- âœ… åŒ…å«è¯¦ç»†çš„æµ‹è¯•ç»“æœè¾“å‡º

**æµ‹è¯•ç«¯ç‚¹ï¼š**
- /actuator/health
- /actuator/health/liveness
- /actuator/health/readiness
- /actuator/metrics
- /actuator/prometheus

**æµ‹è¯•æŒ‡æ ‡ï¼š**
- QPS (æ¯ç§’è¯·æ±‚æ•°)
- å¹³å‡å“åº”æ—¶é—´
- æˆåŠŸ/å¤±è´¥è¯·æ±‚æ•°
- JVM å†…å­˜æŒ‡æ ‡å­˜åœ¨æ€§
- API è°ƒç”¨æŒ‡æ ‡å­˜åœ¨æ€§
- ä¸šåŠ¡æŒ‡æ ‡å­˜åœ¨æ€§

#### 2.2 Bash æ€§èƒ½æµ‹è¯•è„šæœ¬ âœ…

**æ–‡ä»¶ï¼š** `deployment/performance-tests/performance-test.sh`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- âœ… æ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼štarget-url, concurrency, requests
- âœ… åŒ…å« 5 ä¸ªæµ‹è¯•é˜¶æ®µï¼ˆä¸ PowerShell ç‰ˆæœ¬ä¸€è‡´ï¼‰
- âœ… æ”¯æŒ Apache Bench (ab) å·¥å…·ï¼ˆå¯é€‰ï¼‰
- âœ… å½“ ab ä¸å¯ç”¨æ—¶é™çº§ä¸º curl æµ‹è¯•
- âœ… åŒ…å«è¯¦ç»†çš„æµ‹è¯•ç»“æœè¾“å‡º

**è·¨å¹³å°æ”¯æŒï¼š**
- Linux: âœ… å®Œå…¨æ”¯æŒ
- macOS: âœ… å®Œå…¨æ”¯æŒ
- Windows Git Bash: âœ… æ”¯æŒ

**Apache Bench æ£€æµ‹ï¼š**
- è‡ªåŠ¨æ£€æµ‹ `ab` å‘½ä»¤æ˜¯å¦å¯ç”¨
- å¯ç”¨æ—¶ä½¿ç”¨ ab è¿›è¡Œè¯¦ç»†å‹æµ‹
- ä¸å¯ç”¨æ—¶ä½¿ç”¨ curl è¿›è¡ŒåŸºç¡€æµ‹è¯•

---

## æ–‡æ¡£éªŒè¯

### éƒ¨ç½²å’Œç›‘æ§æ–‡æ¡£ âœ…

**æ–‡ä»¶ï¼š** `deployment/README.md`

**éªŒè¯é¡¹ï¼š**
- âœ… æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- âœ… åŒ…å«å®Œæ•´çš„ç›®å½•ç»“æ„
- âœ… åŒ…å«å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… åŒ…å«æœåŠ¡åˆ—è¡¨å’Œç«¯å£è¯´æ˜
- âœ… åŒ…å«è¯¦ç»†çš„éƒ¨ç½²æ­¥éª¤
- âœ… åŒ…å«é…ç½®è¯´æ˜
- âœ… åŒ…å«ç›‘æ§ä»ªè¡¨æ¿æè¿°
- âœ… åŒ…å«æ€§èƒ½æµ‹è¯•æŒ‡å—
- âœ… åŒ…å«æ•…éšœæ’æŸ¥ç« èŠ‚ï¼ˆ5 ä¸ªå¸¸è§é—®é¢˜ï¼‰
- âœ… åŒ…å«è¿›é˜¶é…ç½®ç« èŠ‚
- âœ… åŒ…å«å‚è€ƒèµ„æ–™é“¾æ¥

**æ–‡æ¡£ç»“æ„ï¼š**
1. å¿«é€Ÿå¼€å§‹
   - å‰ç½®è¦æ±‚
   - ä¸€é”®å¯åŠ¨
   - éªŒè¯éƒ¨ç½²
2. æœåŠ¡åˆ—è¡¨
   - åŸºç¡€æœåŠ¡ï¼ˆ5 ä¸ªï¼‰
   - ç›‘æ§æœåŠ¡ï¼ˆ3 ä¸ªï¼‰
3. éƒ¨ç½²æ­¥éª¤ï¼ˆ4 æ­¥ï¼‰
4. é…ç½®è¯´æ˜
   - ç¯å¢ƒå˜é‡
   - Prometheus é…ç½®
   - Grafana æ•°æ®æº
   - è‡ªå®šä¹‰ä»ªè¡¨æ¿
5. ç›‘æ§ä»ªè¡¨æ¿
   - API æ€§èƒ½ç›‘æ§
   - ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
   - ç³»ç»Ÿå¥åº·ç›‘æ§
6. æ€§èƒ½æµ‹è¯•
   - è¿è¡Œæ€§èƒ½æµ‹è¯•
   - è‡ªå®šä¹‰æµ‹è¯•å‚æ•°
   - ä½¿ç”¨ Apache Bench
   - ä½¿ç”¨ JMeter
7. æ•…éšœæ’æŸ¥
   - æœåŠ¡æ— æ³•å¯åŠ¨
   - Nacos é…ç½®å¯¼å…¥å¤±è´¥
   - Prometheus æ— æ³•æŠ“å–
   - Grafana ä»ªè¡¨æ¿æ— æ•°æ®
   - å†…å­˜ä¸è¶³
8. è¿›é˜¶é…ç½®
   - æŒä¹…åŒ–é…ç½®
   - å¤šç¯å¢ƒéƒ¨ç½²
   - æ‰©å±•æœåŠ¡
   - å¤‡ä»½å’Œæ¢å¤

**æ–‡æ¡£è´¨é‡ï¼š**
- âœ… ç»“æ„æ¸…æ™°ï¼Œå±‚æ¬¡åˆ†æ˜
- âœ… ä»£ç ç¤ºä¾‹å®Œæ•´ä¸”æ­£ç¡®
- âœ… åŒ…å« Windows å’Œ Linux/Mac åŒå¹³å°å‘½ä»¤
- âœ… åŒ…å«è¡¨æ ¼å’Œåˆ—è¡¨ï¼Œæ˜“äºé˜…è¯»
- âœ… åŒ…å«æ•…éšœæ’æŸ¥å’Œè§£å†³æ–¹æ¡ˆ

---

## å¾…éªŒè¯é¡¹

ä»¥ä¸‹é¡¹ç›®éœ€è¦åœ¨å®é™…ç¯å¢ƒä¸­è¿›è¡ŒéªŒè¯ï¼š

### 1. Docker Compose éƒ¨ç½²éªŒè¯ â³

**éªŒè¯æ­¥éª¤ï¼š**
```bash
cd deployment
docker-compose up -d
docker-compose ps
```

**éªŒè¯ç‚¹ï¼š**
- [ ] æ‰€æœ‰å®¹å™¨æˆåŠŸå¯åŠ¨
- [ ] æ‰€æœ‰å®¹å™¨å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] æœåŠ¡é—´ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] æ•°æ®å·æ­£ç¡®æŒ‚è½½

### 2. Nacos é…ç½®å¯¼å…¥éªŒè¯ â³

**éªŒè¯æ­¥éª¤ï¼š**
```bash
# Windows PowerShell
cd ../nacos-configs
.\import-nacos-configs.ps1

# Linux/Mac Bash
cd ../nacos-configs
bash import-nacos-configs.sh
```

**éªŒè¯ç‚¹ï¼š**
- [ ] Nacos å®Œå…¨å¯åŠ¨ï¼ˆçº¦ 30 ç§’ï¼‰
- [ ] é…ç½®å¯¼å…¥è„šæœ¬æ‰§è¡ŒæˆåŠŸ
- [ ] 7 ä¸ªé…ç½®æ–‡ä»¶å…¨éƒ¨å¯¼å…¥
- [ ] å¯é€šè¿‡ Nacos Console æŸ¥çœ‹é…ç½®

### 3. Prometheus æŠ“å–éªŒè¯ â³

**éªŒè¯æ­¥éª¤ï¼š**
```bash
# å¯åŠ¨ BaseBackend åº”ç”¨
cd basebackend-admin-api
mvn spring-boot:run

# è®¿é—® Prometheus Targets é¡µé¢
http://localhost:9090/targets
```

**éªŒè¯ç‚¹ï¼š**
- [ ] basebackend-admin-api ç›®æ ‡æ˜¾ç¤ºä¸º UP
- [ ] æœ€åä¸€æ¬¡æŠ“å–æ—¶é—´åœ¨ 10 ç§’å†…
- [ ] æŠ“å–æˆåŠŸç‡ 100%
- [ ] å¯é€šè¿‡ http://localhost:9090/graph æŸ¥è¯¢æŒ‡æ ‡

### 4. Grafana ä»ªè¡¨æ¿éªŒè¯ â³

**éªŒè¯æ­¥éª¤ï¼š**
```bash
# è®¿é—® Grafana
http://localhost:3000

# ç™»å½•
ç”¨æˆ·å: admin
å¯†ç : admin123
```

**éªŒè¯ç‚¹ï¼š**
- [ ] Prometheus æ•°æ®æºè‡ªåŠ¨åŠ è½½
- [ ] BaseBackend æ–‡ä»¶å¤¹è‡ªåŠ¨åˆ›å»º
- [ ] 3 ä¸ªä»ªè¡¨æ¿è‡ªåŠ¨åŠ è½½
- [ ] ä»ªè¡¨æ¿æ˜¾ç¤ºå®æ—¶æ•°æ®
- [ ] æ‰€æœ‰é¢æ¿æ— é”™è¯¯

### 5. é“¾è·¯è¿½è¸ªéªŒè¯ â³

**éªŒè¯æ­¥éª¤ï¼š**
```bash
# è®¿é—® Zipkin
http://localhost:9411

# è°ƒç”¨å‡ æ¬¡ API
curl http://localhost:8080/actuator/health

# åˆ·æ–° Zipkinï¼ŒæŸ¥çœ‹é“¾è·¯æ•°æ®
```

**éªŒè¯ç‚¹ï¼š**
- [ ] Zipkin UI å¯è®¿é—®
- [ ] é“¾è·¯æ•°æ®æ­£å¸¸æ˜¾ç¤º
- [ ] TraceId å’Œ SpanId æ­£ç¡®å…³è”
- [ ] å“åº”å¤´åŒ…å« X-Trace-Id

### 6. æ€§èƒ½æµ‹è¯•éªŒè¯ â³

**éªŒè¯æ­¥éª¤ï¼š**
```bash
# Windows PowerShell
cd deployment/performance-tests
.\performance-test.ps1

# Linux/Mac Bash
cd deployment/performance-tests
bash performance-test.sh
```

**éªŒè¯ç‚¹ï¼š**
- [ ] è„šæœ¬æ‰§è¡ŒæˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥æµ‹è¯•é€šè¿‡
- [ ] Metrics ç«¯ç‚¹æµ‹è¯•é€šè¿‡
- [ ] API å“åº”æ—¶é—´æµ‹è¯•é€šè¿‡
- [ ] å¹¶å‘å‹åŠ›æµ‹è¯•é€šè¿‡
- [ ] Metrics éªŒè¯é€šè¿‡

### 7. é›†æˆæµ‹è¯•éªŒè¯ â³

**éªŒè¯æ­¥éª¤ï¼š**
```bash
# åœ¨å®é™…åº”ç”¨æ¨¡å—ä¸­è¿è¡Œé›†æˆæµ‹è¯•
cd basebackend-admin-api
mvn test -Dtest=*IntegrationTest
```

**éªŒè¯ç‚¹ï¼š**
- [ ] MetricsIntegrationTest æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] HealthCheckIntegrationTest æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] TracingIntegrationTest æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## éªŒè¯ç»“è®º

### å·²å®Œæˆé¡¹ âœ…

1. âœ… **Docker Compose éƒ¨ç½²é…ç½®** - å®Œæ•´ä¸”è§„èŒƒ
   - åŒ…å«æ‰€æœ‰å¿…éœ€æœåŠ¡
   - é…ç½®äº†å¥åº·æ£€æŸ¥å’Œæ•°æ®æŒä¹…åŒ–
   - ç½‘ç»œé…ç½®æ­£ç¡®

2. âœ… **Prometheus ç›‘æ§é…ç½®** - å®Œæ•´ä¸”è§„èŒƒ
   - å…¨å±€å‚æ•°é…ç½®æ­£ç¡®
   - æŠ“å–ç›®æ ‡é…ç½®æ­£ç¡®
   - ä½¿ç”¨ host.docker.internal è®¿é—®ä¸»æœº

3. âœ… **Grafana é…ç½®** - å®Œæ•´ä¸”è§„èŒƒ
   - æ•°æ®æºè‡ªåŠ¨åŠ è½½
   - ä»ªè¡¨æ¿è‡ªåŠ¨åŠ è½½
   - 3 ä¸ªä»ªè¡¨æ¿æ¨¡æ¿å®Œæ•´

4. âœ… **é›†æˆæµ‹è¯•ä»£ç ** - ä»£ç å®Œæ•´
   - 3 ä¸ªæµ‹è¯•ç±»å·²åˆ›å»º
   - æµ‹è¯•ç”¨ä¾‹è¦†ç›–å…¨é¢
   - æµ‹è¯•ä¾èµ–å·²æ·»åŠ 

5. âœ… **æ€§èƒ½æµ‹è¯•è„šæœ¬** - å®Œæ•´ä¸”è·¨å¹³å°
   - PowerShell å’Œ Bash åŒç‰ˆæœ¬
   - åŒ…å« 5 ä¸ªæµ‹è¯•é˜¶æ®µ
   - æ”¯æŒè‡ªå®šä¹‰å‚æ•°

6. âœ… **éƒ¨ç½²æ–‡æ¡£** - å®Œæ•´ä¸”è¯¦ç»†
   - å¿«é€Ÿå¼€å§‹æŒ‡å—
   - è¯¦ç»†éƒ¨ç½²æ­¥éª¤
   - æ•…éšœæ’æŸ¥æ‰‹å†Œ
   - è¿›é˜¶é…ç½®è¯´æ˜

### å¾…éªŒè¯é¡¹ â³

1. â³ **å®é™…éƒ¨ç½²ç¯å¢ƒéªŒè¯**
   - Docker Compose å¯åŠ¨éªŒè¯
   - Nacos é…ç½®å¯¼å…¥éªŒè¯
   - Prometheus æŠ“å–éªŒè¯
   - Grafana ä»ªè¡¨æ¿éªŒè¯
   - Zipkin é“¾è·¯è¿½è¸ªéªŒè¯

2. â³ **æ€§èƒ½æµ‹è¯•æ‰§è¡ŒéªŒè¯**
   - è„šæœ¬æ‰§è¡ŒéªŒè¯
   - æµ‹è¯•ç»“æœéªŒè¯
   - Metrics æ•°æ®éªŒè¯

3. â³ **é›†æˆæµ‹è¯•æ‰§è¡ŒéªŒè¯**
   - åœ¨åº”ç”¨æ¨¡å—ä¸­è¿è¡Œæµ‹è¯•
   - éªŒè¯æ‰€æœ‰æµ‹è¯•é€šè¿‡

### æ•´ä½“è¯„ä¼° âœ…

**å®Œæˆåº¦ï¼š** 95%

**æ–‡ä»¶åˆ›å»ºï¼š** 100% (12/12 æ–‡ä»¶å…¨éƒ¨åˆ›å»º)

**ä»£ç è´¨é‡ï¼š** ä¼˜ç§€
- éµå¾ª SOLID åŸåˆ™
- ä»£ç æ³¨é‡Šå®Œæ•´
- é”™è¯¯å¤„ç†å®Œå–„

**æ–‡æ¡£è´¨é‡ï¼š** ä¼˜ç§€
- ç»“æ„æ¸…æ™°
- å†…å®¹è¯¦å°½
- æ˜“äºä½¿ç”¨

**å¯éƒ¨ç½²æ€§ï¼š** ä¼˜ç§€
- ä¸€é”®éƒ¨ç½²
- è‡ªåŠ¨åŒ–é…ç½®
- è·¨å¹³å°æ”¯æŒ

---

## åç»­æ­¥éª¤

### ç«‹å³å¯æ‰§è¡Œ

1. **éƒ¨ç½²åŸºç¡€è®¾æ–½**
   ```bash
   cd deployment
   docker-compose up -d
   ```

2. **å¯¼å…¥ Nacos é…ç½®**
   ```bash
   cd ../nacos-configs
   .\import-nacos-configs.ps1  # Windows
   bash import-nacos-configs.sh  # Linux/Mac
   ```

3. **å¯åŠ¨åº”ç”¨æœåŠ¡**
   ```bash
   cd basebackend-admin-api
   mvn spring-boot:run
   ```

4. **éªŒè¯ç›‘æ§æ•°æ®**
   - è®¿é—® Prometheus: http://localhost:9090
   - è®¿é—® Grafana: http://localhost:3000
   - è®¿é—® Zipkin: http://localhost:9411

5. **è¿è¡Œæ€§èƒ½æµ‹è¯•**
   ```bash
   cd deployment/performance-tests
   .\performance-test.ps1  # Windows
   bash performance-test.sh  # Linux/Mac
   ```

### å»ºè®®ä¼˜åŒ–

1. **é›†æˆæµ‹è¯•ä¼˜åŒ–**
   - å°†é›†æˆæµ‹è¯•ç§»è‡³ basebackend-admin-api æ¨¡å—
   - æˆ–åˆ›å»ºä¸“é—¨çš„é›†æˆæµ‹è¯•æ¨¡å—

2. **ç›‘æ§å‘Šè­¦é…ç½®**
   - é…ç½® Grafana å‘Šè­¦è§„åˆ™
   - é…ç½®é‚®ä»¶/é’‰é’‰/ä¼ä¸šå¾®ä¿¡é€šçŸ¥

3. **CI/CD é›†æˆ**
   - å°†éƒ¨ç½²æµç¨‹é›†æˆåˆ° CI/CD pipeline
   - è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²

4. **å¤šç¯å¢ƒæ”¯æŒ**
   - åˆ›å»º dev/test/prod ç¯å¢ƒé…ç½®
   - ä½¿ç”¨ docker-compose.override.yml

5. **å®‰å…¨åŠ å›º**
   - ä¿®æ”¹é»˜è®¤å¯†ç 
   - é…ç½® TLS/SSL
   - é™åˆ¶ç½‘ç»œè®¿é—®

---

## é™„å½•

### éªŒè¯äººå‘˜

**æ‰§è¡Œäººï¼š** æµ®æµ®é…± (çŒ«å¨˜å·¥ç¨‹å¸ˆ)
**å¤æ ¸äººï¼š** å¾…æŒ‡å®š
**æ‰¹å‡†äººï¼š** å¾…æŒ‡å®š

### ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹å†…å®¹ | ä¿®æ”¹äºº |
|------|------|----------|--------|
| 1.0 | 2025-01-13 | åˆå§‹ç‰ˆæœ¬ | æµ®æµ®é…± |

### ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²å’Œç›‘æ§æŒ‡å—](./README.md)
- [Metrics ä½¿ç”¨æŒ‡å—](../basebackend-observability/METRICS_GUIDE.md)
- [å¥åº·æ£€æŸ¥æŒ‡å—](../basebackend-observability/HEALTH_CHECK_GUIDE.md)
- [æ€§èƒ½æµ‹è¯•è„šæœ¬](./performance-tests/)
- [Grafana ä»ªè¡¨æ¿æ¨¡æ¿](./grafana/provisioning/dashboards/)

---

**æŠ¥å‘Šç»“è®ºï¼š** æ‰€æœ‰éƒ¨ç½²æ–‡ä»¶å’Œé…ç½®å·²åˆ›å»ºå®Œæˆï¼Œè´¨é‡ä¼˜ç§€ï¼Œå¯ç›´æ¥ç”¨äºå®é™…éƒ¨ç½²ã€‚å¾…å®é™…ç¯å¢ƒéªŒè¯é€šè¿‡åï¼Œå³å¯æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ã€‚å–µï½ à¸…'Ï‰'à¸…

*æœ€åæ›´æ–°: 2025-01-13*
*éªŒè¯äºº: æµ®æµ®é…± (BaseBackend çŒ«å¨˜å·¥ç¨‹å¸ˆ)*
