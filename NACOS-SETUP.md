# Nacos ç»Ÿä¸€é…ç½®ç®¡ç†è®¾ç½®æŒ‡å—

## ğŸ¯ é—®é¢˜è§£å†³

### åŸé—®é¢˜
```
No spring.config.import property has been defined
Add a spring.config.import=nacos: property to your configuration.
```

### è§£å†³æ–¹æ¡ˆ
âœ… åˆ›å»ºäº† `basebackend-nacos` é…ç½®ç®¡ç†æ¨¡å—  
âœ… ä¿®å¤äº† `spring.config.import` é…ç½®é—®é¢˜  
âœ… å®ç°äº†ç»Ÿä¸€é…ç½®ç®¡ç†  

## ğŸ—ï¸ æ–°æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nacos é…ç½®ä¸­å¿ƒ                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ common-config   â”‚ â”‚ gateway-config  â”‚ â”‚ demo-api-config â”‚ â”‚
â”‚  â”‚ (é€šç”¨é…ç½®)      â”‚ â”‚ (Gatewayä¸“ç”¨)   â”‚ â”‚ (Demo-APIä¸“ç”¨)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                basebackend-nacos æ¨¡å—                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ é…ç½®å±æ€§ç®¡ç†    â”‚ â”‚ è‡ªåŠ¨é…ç½®ç±»      â”‚ â”‚ é…ç½®ç®¡ç†å™¨      â”‚ â”‚
â”‚  â”‚ NacosConfig     â”‚ â”‚ NacosAutoConfig â”‚ â”‚ NacosConfigMgr  â”‚ â”‚
â”‚  â”‚ Properties      â”‚ â”‚ uration         â”‚ â”‚ anager          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¾®æœåŠ¡åº”ç”¨                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Gateway       â”‚ â”‚   Demo-API      â”‚ â”‚   å…¶ä»–æœåŠ¡      â”‚ â”‚
â”‚  â”‚   Port: 8180    â”‚ â”‚   Port: 8081    â”‚ â”‚                 â”‚ â”‚
â”‚  â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚
â”‚  â”‚ - ç»Ÿä¸€é…ç½®ç®¡ç†  â”‚ â”‚ - ç»Ÿä¸€é…ç½®ç®¡ç†  â”‚ â”‚ - ç»Ÿä¸€é…ç½®ç®¡ç†  â”‚ â”‚
â”‚  â”‚ - æœåŠ¡å‘ç°      â”‚ â”‚ - æœåŠ¡å‘ç°      â”‚ â”‚ - æœåŠ¡å‘ç°      â”‚ â”‚
â”‚  â”‚ - åŠ¨æ€é…ç½®      â”‚ â”‚ - åŠ¨æ€é…ç½®      â”‚ â”‚ - åŠ¨æ€é…ç½®      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å¯åŠ¨ Nacos
```bash
# æ–¹å¼ä¸€ï¼šDocker Compose
docker-compose up -d

# æ–¹å¼äºŒï¼šæœ¬åœ°å®‰è£…
./start-nacos.sh
```

### 2. ä¸Šä¼ é…ç½®
```bash
# è‡ªåŠ¨ä¸Šä¼ é…ç½®åˆ° Nacos
./upload-nacos-configs.sh
```

### 3. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆè‡ªåŠ¨ä¸Šä¼ é…ç½®ï¼‰
./start-services.sh

# æˆ–åˆ†åˆ«å¯åŠ¨
cd basebackend-demo-api && mvn spring-boot:run &
cd basebackend-gateway && mvn spring-boot:run &
```

## ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„

```
basebackend/
â”œâ”€â”€ basebackend-nacos/                    # Nacos é…ç½®ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ src/main/java/com/basebackend/nacos/
â”‚   â”‚   â””â”€â”€ config/
â”‚   â”‚       â”œâ”€â”€ NacosConfigProperties.java
â”‚   â”‚       â”œâ”€â”€ NacosAutoConfiguration.java
â”‚   â”‚       â”œâ”€â”€ NacosConfigManager.java
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ src/main/resources/
â”‚       â””â”€â”€ application-nacos.yml
â”œâ”€â”€ nacos-configs/                        # Nacos é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ common-config.yml                 # é€šç”¨é…ç½®
â”‚   â”œâ”€â”€ gateway-config.yml                # Gateway é…ç½®
â”‚   â””â”€â”€ demo-api-config.yml               # Demo-API é…ç½®
â”œâ”€â”€ basebackend-gateway/
â”‚   â”œâ”€â”€ src/main/resources/
â”‚   â”‚   â”œâ”€â”€ bootstrap.yml                 # å¯åŠ¨é…ç½®
â”‚   â”‚   â””â”€â”€ application.yml               # åº”ç”¨é…ç½®
â””â”€â”€ basebackend-demo-api/
    â”œâ”€â”€ src/main/resources/
    â”‚   â”œâ”€â”€ bootstrap.yml                 # å¯åŠ¨é…ç½®
    â”‚   â””â”€â”€ application.yml               # åº”ç”¨é…ç½®
```

## âš™ï¸ é…ç½®è¯´æ˜

### Bootstrap é…ç½®
```yaml
spring:
  application:
    name: basebackend-gateway
  profiles:
    active: nacos
  config:
    import: 
      - optional:nacos:${NACOS_SERVER_ADDR:localhost:8848}
      - classpath:application-nacos.yml
```

### å…³é”®é…ç½®é¡¹
- `spring.config.import=nacos:` - è§£å†³å¯åŠ¨é”™è¯¯
- `optional:nacos:` - å¯é€‰é…ç½®ï¼ŒNacos ä¸å¯ç”¨æ—¶ä»èƒ½å¯åŠ¨
- `import-check.enabled=false` - ç¦ç”¨å¯¼å…¥æ£€æŸ¥

## ğŸ”§ ç»Ÿä¸€é…ç½®ç®¡ç†

### 1. é…ç½®åˆ†å±‚
- **common-config.yml**: æ‰€æœ‰æœåŠ¡å…±äº«çš„é€šç”¨é…ç½®
- **gateway-config.yml**: Gateway ä¸“ç”¨é…ç½®
- **demo-api-config.yml**: Demo-API ä¸“ç”¨é…ç½®

### 2. é…ç½®ä¼˜å…ˆçº§
1. æœ¬åœ° application.yml
2. Nacos é…ç½®ä¸­å¿ƒ
3. ç¯å¢ƒå˜é‡
4. é»˜è®¤å€¼

### 3. åŠ¨æ€é…ç½®æ›´æ–°
- é…ç½®å˜æ›´è‡ªåŠ¨æ¨é€åˆ°æœåŠ¡
- æ”¯æŒçƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯
- é…ç½®ç‰ˆæœ¬ç®¡ç†

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°é…ç½®
1. åœ¨ `nacos-configs/` ç›®å½•æ·»åŠ é…ç½®æ–‡ä»¶
2. è¿è¡Œ `./upload-nacos-configs.sh` ä¸Šä¼ é…ç½®
3. åœ¨æœåŠ¡ä¸­é€šè¿‡ `@Value` æˆ– `@ConfigurationProperties` ä½¿ç”¨

### æ·»åŠ æ–°æœåŠ¡
1. åœ¨æœåŠ¡ POM ä¸­æ·»åŠ  `basebackend-nacos` ä¾èµ–
2. åˆ›å»º `bootstrap.yml` é…ç½®æ–‡ä»¶
3. åœ¨ Nacos ä¸­åˆ›å»ºå¯¹åº”çš„é…ç½®æ–‡ä»¶

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **å¯åŠ¨æŠ¥é”™ `No spring.config.import`**
   - âœ… å·²è§£å†³ï¼šæ·»åŠ äº† `spring.config.import=nacos:`

2. **é…ç½®ä¸ç”Ÿæ•ˆ**
   - æ£€æŸ¥ Nacos æœåŠ¡æ˜¯å¦å¯åŠ¨
   - æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®ä¸Šä¼ 
   - æŸ¥çœ‹æœåŠ¡æ—¥å¿—

3. **æœåŠ¡æ³¨å†Œå¤±è´¥**
   - æ£€æŸ¥ Nacos è¿æ¥é…ç½®
   - æŸ¥çœ‹ç½‘ç»œè¿æ¥
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### æ—¥å¿—é…ç½®
```yaml
logging:
  level:
    com.alibaba.cloud.nacos: DEBUG
    com.basebackend.nacos: DEBUG
```

## ğŸ“Š ç›‘æ§å’Œç®¡ç†

### Nacos æ§åˆ¶å°
- è®¿é—®åœ°å€: http://localhost:8848/nacos
- ç”¨æˆ·å/å¯†ç : nacos/nacos
- åŠŸèƒ½: æœåŠ¡ç®¡ç†ã€é…ç½®ç®¡ç†ã€ç›‘æ§é¢æ¿

### é…ç½®ç®¡ç†
- æŸ¥çœ‹é…ç½®åˆ—è¡¨
- ç¼–è¾‘é…ç½®å†…å®¹
- é…ç½®å†å²ç‰ˆæœ¬
- é…ç½®æ¨é€è®°å½•

## ğŸ‰ ä¼˜åŠ¿æ€»ç»“

âœ… **ç»Ÿä¸€é…ç½®ç®¡ç†**: æ‰€æœ‰é…ç½®é›†ä¸­åœ¨ Nacos  
âœ… **åŠ¨æ€é…ç½®æ›´æ–°**: é…ç½®å˜æ›´å®æ—¶ç”Ÿæ•ˆ  
âœ… **é…ç½®ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒé…ç½®å›æ»š  
âœ… **ç¯å¢ƒéš”ç¦»**: æ”¯æŒå¤šç¯å¢ƒé…ç½®  
âœ… **é…ç½®åŠ å¯†**: æ”¯æŒæ•æ„Ÿé…ç½®åŠ å¯†  
âœ… **ç›‘æ§å‘Šè­¦**: é…ç½®å˜æ›´é€šçŸ¥  

ç°åœ¨æ‚¨çš„é¡¹ç›®å·²ç»æˆåŠŸé›†æˆäº† Nacos ç»Ÿä¸€é…ç½®ç®¡ç†ï¼ğŸŠ
