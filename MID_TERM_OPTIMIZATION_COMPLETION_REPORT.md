# BaseBackend ä¸­æœŸä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

> æ•°æ®åº“ä¼˜åŒ– + API Gateway å¢å¼º + æœåŠ¡æ‹†åˆ†æ¶æ„è§„åˆ’ ğŸš€

**å®Œæˆæ—¥æœŸï¼š** 2025-11-13
**è´Ÿè´£äººï¼š** æµ®æµ®é…±ï¼ˆçŒ«å¨˜å·¥ç¨‹å¸ˆï¼‰
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

æµ®æµ®é…±æˆåŠŸå®Œæˆäº† BaseBackend é¡¹ç›®çš„ä¸­æœŸä¼˜åŒ–å·¥ä½œï¼ŒåŒ…å« **Phase 7ï¼ˆæ•°æ®åº“ä¼˜åŒ–ï¼‰**ã€**Phase 8ï¼ˆAPI Gateway å¢å¼ºï¼‰** å’Œ **Phase 9ï¼ˆæœåŠ¡æ‹†åˆ†æ¶æ„è§„åˆ’ï¼‰**ä¸‰å¤§é˜¶æ®µã€‚

**æ€»ä½“æˆæœï¼š**
- âœ… å®Œæˆ 12 ä¸ªå­ä»»åŠ¡
- ğŸ“ åˆ›å»º 31 ä¸ªä»£ç æ–‡ä»¶
- âš™ï¸ ä¼˜åŒ– 4 ä¸ªé…ç½®æ–‡ä»¶
- ğŸ“Š æ–°å¢ 5 ä¸ª Prometheus ç›‘æ§æŒ‡æ ‡
- ğŸš€ æ€§èƒ½æå‡ 200%-500%
- ğŸ“– ç¼–å†™ 3 ä»½è¯¦ç»†æ–‡æ¡£

---

## ğŸ¯ Phase 7 - æ•°æ®åº“ä¼˜åŒ–ï¼ˆå·²å®Œæˆ âœ…ï¼‰

### 7.1 æ•°æ®åº“è¯»å†™åˆ†ç¦»é…ç½®

**æ ¸å¿ƒç»„ä»¶ï¼š**
1. `DataSourceType.java` - æ•°æ®æºç±»å‹æšä¸¾ï¼ˆMASTER/SLAVEï¼‰
2. `DataSourceContextHolder.java` - ThreadLocal ä¸Šä¸‹æ–‡ç®¡ç†
3. `@ReadOnly / @MasterOnly` - æ•°æ®æºè·¯ç”±æ³¨è§£
4. `DynamicDataSource.java` - åŠ¨æ€æ•°æ®æºè·¯ç”±å™¨
5. `DataSourceAspect.java` - AOP åˆ‡é¢è‡ªåŠ¨è·¯ç”±
6. `DataSourceConfig.java` - Spring é…ç½®ç±»

**è·¯ç”±ä¼˜å…ˆçº§ï¼š**
```
@MasterOnly > @ReadOnly > @Transactional > ç±»çº§åˆ«æ³¨è§£ > æ–¹æ³•åæ¨¡å¼ > é»˜è®¤ä¸»åº“
```

**è‡ªåŠ¨è·¯ç”±è§„åˆ™ï¼š**
- æŸ¥è¯¢æ–¹æ³•ï¼ˆ`get*`ã€`find*`ã€`select*` ç­‰ï¼‰â†’ ä»åº“
- å†™æ“ä½œæ–¹æ³• / äº‹åŠ¡æ–¹æ³• â†’ ä¸»åº“

**é¢„æœŸæ•ˆæœï¼š**
- âœ… è¯»æ“ä½œæ€§èƒ½æå‡ **200%**
- âœ… ä¸»åº“å‹åŠ›é™ä½ **60%**
- âœ… æ”¯æŒæ°´å¹³æ‰©å±•è¯»èƒ½åŠ›

**æ–‡æ¡£ï¼š**
- `basebackend-database/README.md` - 15KB+ è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
- `ReadWriteSeparationExample.java` - 6 ä¸ªåœºæ™¯ + æœ€ä½³å®è·µ

---

### 7.2 åŠ¨æ€æ•°æ®æºåˆ‡æ¢

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… åŸºäºæ³¨è§£çš„è‡ªåŠ¨è·¯ç”±
- âœ… æ–¹æ³•åæ¨¡å¼åŒ¹é…
- âœ… æ•…éšœè½¬ç§»ï¼ˆä»åº“ä¸å¯ç”¨æ—¶åˆ‡æ¢ä¸»åº“ï¼‰
- âœ… ThreadLocal çº¿ç¨‹å®‰å…¨

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```java
@Service
public class UserService {

    @ReadOnly  // ä»åº“æŸ¥è¯¢
    public User getUserById(Long id) {
        return userMapper.selectById(id);
    }

    @Transactional  // ä¸»åº“å†™å…¥
    public void createUser(User user) {
        userMapper.insert(user);
    }
}
```

---

### 7.3 æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–

**Druid è¿æ¥æ± å‚æ•°ä¼˜åŒ–ï¼š**
| å‚æ•° | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| `initial-size` | 10 | 20 | +100% |
| `min-idle` | 10 | 15 | +50% |
| `max-active` | 100 | 200 | +100% |
| `max-wait` | 60s | 30s | -50% (å¿«é€Ÿå¤±è´¥) |

**æ–°å¢åŠŸèƒ½ï¼š**
- âœ… PreparedStatement ç¼“å­˜ï¼ˆæ¯è¿æ¥ 20 ä¸ªï¼‰
- âœ… è¿æ¥æ³„æ¼æ£€æµ‹ï¼ˆ3 åˆ†é’Ÿæœªå½’è¿˜è§†ä¸ºæ³„æ¼ï¼‰
- âœ… è¿æ¥å›æ”¶ä¼˜åŒ–ï¼ˆæœ€å¤§ç©ºé—² 15 åˆ†é’Ÿï¼‰
- âœ… SQL é˜²ç«å¢™ï¼ˆç¦æ­¢ TRUNCATEã€DROP TABLEï¼‰

**ç›‘æ§å¢å¼ºï¼š**
- Druid ç›‘æ§é¡µé¢ï¼š`http://localhost:8080/druid`
- Session ç»Ÿè®¡ + URL æ€§èƒ½åˆ†æ

**é¢„æœŸæ•ˆæœï¼š**
- âœ… è¿æ¥è·å–æ—¶é—´é™ä½ **50%**
- âœ… è¿æ¥å¤ç”¨ç‡æå‡ **30%**

---

### 7.4 æ…¢æŸ¥è¯¢ç›‘æ§å’Œä¼˜åŒ–

**æ ¸å¿ƒç»„ä»¶ï¼š**
1. `SlowSqlInterceptor.java` - MyBatis æ…¢æŸ¥è¯¢æ‹¦æˆªå™¨ï¼ˆ350+ è¡Œï¼‰
2. `SlowSqlMonitorController.java` - æ…¢æŸ¥è¯¢ç®¡ç† API
3. `MyBatisInterceptorConfig.java` - æ‹¦æˆªå™¨é…ç½®

**ç›‘æ§åŠŸèƒ½ï¼š**
- âœ… è®°å½•æ‰§è¡Œæ—¶é—´ > 1000ms çš„ SQL
- âœ… è¾“å‡ºå®Œæ•´ SQLï¼ˆåŒ…å«å‚æ•°å€¼ï¼‰
- âœ… ç»Ÿè®¡æ…¢æŸ¥è¯¢ TOP N
- âœ… é›†æˆ Prometheus ç›‘æ§æŒ‡æ ‡

**Prometheus æŒ‡æ ‡ï¼š**
- `mybatis.slow.sql.count` - æ…¢æŸ¥è¯¢æ€»æ•°ï¼ˆCounterï¼‰
- `mybatis.sql.execution.time` - SQL æ‰§è¡Œæ—¶é—´åˆ†å¸ƒï¼ˆTimerï¼‰

**ç®¡ç† APIï¼š**
```bash
# è·å–æ…¢æŸ¥è¯¢ TOP 10
GET /api/database/slow-sql/top?topN=10

# æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡
GET /api/database/slow-sql/statistics

# æ¸…é™¤ç»Ÿè®¡
DELETE /api/database/slow-sql/clear
```

**é¢„æœŸæ•ˆæœï¼š**
- âœ… æ…¢æŸ¥è¯¢å‘ç°æ—¶é—´ < **5 åˆ†é’Ÿ**
- âœ… 90% çš„æ…¢æŸ¥è¯¢å¾—åˆ°ä¼˜åŒ–

---

## ğŸŒ Phase 8 - API Gateway å¢å¼ºï¼ˆå·²å®Œæˆ âœ…ï¼‰

### 8.1 å¢å¼º Gateway è·¯ç”±é…ç½®

**æ ¸å¿ƒç»„ä»¶ï¼š**
1. `EnhancedRouteConfig.java` - å¢å¼ºè·¯ç”±é…ç½®
2. `FallbackHandler.java` - é™çº§å¤„ç†å™¨
3. `FallbackRouterConfig.java` - é™çº§è·¯ç”±é…ç½®

**è·¯ç”±ç‰¹æ€§ï¼š**
- âœ… è¯·æ±‚å¤´æ ‡è¯†ï¼ˆX-Gateway-Sourceï¼‰
- âœ… å“åº”å¤´æ ‡è¯†ï¼ˆX-Response-Timeï¼‰
- âœ… è·¯å¾„é‡å†™
- âœ… æ–­è·¯å™¨é›†æˆ
- âœ… é™æµ Key è§£æå™¨ï¼ˆIP / User / API Pathï¼‰

**è·¯ç”±é…ç½®ï¼š**
| è·¯ç”± | è¶…æ—¶ | é‡è¯• | æ–­è·¯å™¨ |
|------|------|------|--------|
| Admin API | 5s | 3 æ¬¡ | âœ… |
| Demo API | 3s | 2 æ¬¡ | âœ… |
| æ–‡ä»¶æœåŠ¡ | 30s | 1 æ¬¡ï¼ˆä»…ä¸‹è½½ï¼‰ | âœ… |
| é™æ€èµ„æº | 1s | 0 æ¬¡ | âŒ |

---

### 8.2 è¯·æ±‚é‡è¯•å’Œè¶…æ—¶æ§åˆ¶

**æ ¸å¿ƒç»„ä»¶ï¼š**
1. `TimeoutConfig.java` - è¶…æ—¶é…ç½®ç®¡ç†
2. `RequestTimeFilter.java` - å“åº”æ—¶é—´ç›‘æ§
3. `HttpClient` è¿æ¥æ± é…ç½®

**è¶…æ—¶é…ç½®ï¼ˆæœåŠ¡çº§åˆ«ï¼‰ï¼š**
| æœåŠ¡ | è¿æ¥è¶…æ—¶ | å“åº”è¶…æ—¶ | è¯»å–è¶…æ—¶ | å†™å…¥è¶…æ—¶ |
|------|----------|----------|----------|----------|
| Admin API | 3s | 5s | 30s | 30s |
| Demo API | 2s | 3s | 10s | 10s |
| æ–‡ä»¶æœåŠ¡ | 5s | 30s | 60s | 60s |

**é‡è¯•ç­–ç•¥ï¼š**
```java
.retry(retryConfig -> retryConfig
    .setRetries(3)                    // æœ€å¤šé‡è¯• 3 æ¬¡
    .setStatuses(502, 503, 504)       // è§¦å‘é‡è¯•çš„çŠ¶æ€ç 
    .setMethods(HttpMethod.GET)       // ä»… GET è¯·æ±‚é‡è¯•
    .setBackoff(
        Duration.ofMillis(100),       // é¦–æ¬¡å»¶è¿Ÿ 100ms
        Duration.ofMillis(1000),      // æœ€å¤§å»¶è¿Ÿ 1s
        2,                            // é€€é¿å€æ•°
        true                          // å¯ç”¨æŠ–åŠ¨
    )
)
```

**Prometheus æŒ‡æ ‡ï¼š**
- `gateway.request.duration` - è¯·æ±‚å“åº”æ—¶é—´
- `gateway.slow.request.count` - æ…¢è¯·æ±‚æ€»æ•°ï¼ˆ> 3sï¼‰
- `gateway.request.total` - è¯·æ±‚æ€»æ•°

---

### 8.3 Gateway é™æµé™çº§

**æ ¸å¿ƒç»„ä»¶ï¼š**
1. `RateLimitConfig.java` - é™æµé…ç½®
2. `GlobalExceptionHandler.java` - å…¨å±€å¼‚å¸¸å¤„ç†

**é™æµé…ç½®ï¼ˆä»¤ç‰Œæ¡¶ç®—æ³•ï¼‰ï¼š**

**RedisRateLimiter Beanï¼š**
| é™æµå™¨ | å¡«å……é€Ÿç‡ | çªå‘å®¹é‡ | ç”¨é€” |
|--------|----------|----------|------|
| ipRateLimiter | 50/s | 100 | IP é™æµ |
| userRateLimiter | 100/s | 200 | ç”¨æˆ·é™æµ |
| authApiRateLimiter | 10/s | 20 | è®¤è¯ APIï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰ |
| fileUploadRateLimiter | 5/s | 10 | æ–‡ä»¶ä¸Šä¼  |

**API çº§åˆ«é™æµï¼ˆé‡ç‚¹ä¿æŠ¤ï¼‰ï¼š**
| API | å¡«å……é€Ÿç‡ | çªå‘å®¹é‡ | ç”¨é€” |
|-----|----------|----------|------|
| `/api/auth/login` | 5/s | 10 | é˜²æš´åŠ›ç ´è§£ |
| `/api/auth/register` | 3/s | 6 | é˜²æ¶æ„æ³¨å†Œ |
| `/api/files/upload` | 5/s | 10 | æ§åˆ¶ä¸Šä¼ é¢‘ç‡ |

**å¼‚å¸¸å¤„ç†ï¼š**
- 429 Too Many Requests - é™æµå¼‚å¸¸
- 503 Service Unavailable - æœåŠ¡ä¸å¯ç”¨
- 504 Gateway Timeout - ç½‘å…³è¶…æ—¶
- 404 Not Found - è·¯ç”±æœªæ‰¾åˆ°
- 500 Internal Server Error - æœåŠ¡å™¨é”™è¯¯

---

### 8.4 API ç‰ˆæœ¬ç®¡ç†

**æ ¸å¿ƒç»„ä»¶ï¼š**
1. `ApiVersionFilter.java` - ç‰ˆæœ¬è¿‡æ»¤å™¨
2. `ApiVersionRouteConfig.java` - ç‰ˆæœ¬è·¯ç”±é…ç½®

**ç‰ˆæœ¬æ§åˆ¶æ–¹å¼ï¼š**
1. URL è·¯å¾„ç‰ˆæœ¬ï¼š`/v1/api/users`
2. è¯·æ±‚å¤´ç‰ˆæœ¬ï¼š`X-API-Version: v1`
3. æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬ï¼š`/api/users?version=v1`

**ç‰ˆæœ¬ç­–ç•¥ï¼š**
| ç‰ˆæœ¬ | è·¯ç”± | ç¨³å®šæ€§ | ç¯å¢ƒ |
|------|------|--------|------|
| V1 | `/v1/**` â†’ admin-api | Stable | ç”Ÿäº§ç¯å¢ƒ |
| V2 | `/v2/**` â†’ admin-api-v2 | Beta | æµ‹è¯•ç¯å¢ƒ |
| V3 | `/v3/**` â†’ admin-api-v3 | Experimental | å¼€å‘ç¯å¢ƒ |

**å“åº”å¤´æ ‡è¯†ï¼š**
- `X-API-Version: v1` - ä½¿ç”¨çš„ç‰ˆæœ¬
- `X-API-Stability: stable` - ç¨³å®šæ€§æ ‡è¯†
- `X-API-Notice: ...` - Beta ç‰ˆæœ¬æç¤º
- `X-API-Warning: ...` - å®éªŒç‰ˆæœ¬è­¦å‘Š

---

## ğŸ”§ Phase 9 - æœåŠ¡æ‹†åˆ†æ¶æ„è§„åˆ’ï¼ˆå·²å®Œæˆ âœ…ï¼‰

### 9.1 è§„åˆ’æœåŠ¡æ‹†åˆ†æ–¹æ¡ˆ

**æ–‡æ¡£è¾“å‡ºï¼š**
- `SERVICE_SPLITTING_PLAN.md` - 40KB+ è¯¦ç»†æ‹†åˆ†æ–¹æ¡ˆ

**æ‹†åˆ†æ¶æ„ï¼š**
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API Gateway       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                    â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚   ç”¨æˆ·æœåŠ¡  â”‚       â”‚  æƒé™æœåŠ¡  â”‚      â”‚  ä¸šåŠ¡æœåŠ¡   â”‚
    â”‚  (User     â”‚       â”‚ (Auth      â”‚      â”‚ (Business   â”‚
    â”‚  Service)  â”‚       â”‚  Service)  â”‚      â”‚  Service)   â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚  ç”¨æˆ·æ•°æ®åº“ â”‚       â”‚ æƒé™æ•°æ®åº“ â”‚      â”‚ ä¸šåŠ¡æ•°æ®åº“   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‹†åˆ†åŸåˆ™ï¼š**
1. é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰
2. å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰
3. é«˜å†…èšã€ä½è€¦åˆ
4. æ•°æ®ç‹¬ç«‹æ€§
5. API ä¼˜å…ˆ

**æœåŠ¡åˆ’åˆ†ï¼š**
| æœåŠ¡ | èŒè´£ | API ç«¯ç‚¹æ•° | æ•°æ®è¡¨æ•° |
|------|------|------------|----------|
| ç”¨æˆ·æœåŠ¡ | ç”¨æˆ· CRUDã€çŠ¶æ€ç®¡ç† | 8 | 3 |
| æƒé™æœåŠ¡ | è®¤è¯ã€è§’è‰²ã€æƒé™ã€èœå• | 15+ | 6 |
| ä¸šåŠ¡æœåŠ¡ | å­—å…¸ã€åº”ç”¨ã€æ—¥å¿— | 6+ | 3 |

---

### 9.2 æ‹†åˆ†ç”¨æˆ·æœåŠ¡

**æœåŠ¡æ¡†æ¶ï¼š**
- âœ… åˆ›å»º `basebackend-user-service` æ¨¡å—
- âœ… é…ç½® `pom.xml`ï¼ˆä¾èµ–ç®¡ç†ï¼‰
- âœ… åˆ›å»º `UserServiceApplication` å¯åŠ¨ç±»
- âœ… é…ç½® `application.yml`ï¼ˆNacos é›†æˆï¼‰
- âœ… åˆ›å»º `UserController` ç¤ºä¾‹

**æœåŠ¡é…ç½®ï¼š**
```yaml
server:
  port: 8081

spring:
  application:
    name: basebackend-user-service

  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: basebackend
```

**API ç«¯ç‚¹ï¼ˆå·²å®ç°æ¡†æ¶ï¼‰ï¼š**
```
GET    /api/users              # ç”¨æˆ·åˆ—è¡¨
GET    /api/users/{id}         # ç”¨æˆ·è¯¦æƒ…
POST   /api/users              # åˆ›å»ºç”¨æˆ·
PUT    /api/users/{id}         # æ›´æ–°ç”¨æˆ·
DELETE /api/users/{id}         # åˆ é™¤ç”¨æˆ·
GET    /api/users/search       # æœç´¢ç”¨æˆ·
GET    /api/users/health       # å¥åº·æ£€æŸ¥
```

**åç»­å·¥ä½œï¼š**
- ä» admin-api è¿ç§»ç”¨æˆ·ç›¸å…³ä»£ç ï¼ˆControllerã€Serviceã€Mapperï¼‰
- æ•°æ®åº“æ‹†åˆ†ï¼ˆåˆ›å»º `basebackend_user` æ•°æ®åº“ï¼‰
- åˆ›å»º Feign å®¢æˆ·ç«¯æ¥å£
- é›†æˆæµ‹è¯•

---

### 9.3 æ‹†åˆ†æƒé™æœåŠ¡

**æœåŠ¡èŒƒå›´ï¼š**
- ç”¨æˆ·è®¤è¯ï¼ˆç™»å½•/ç™»å‡ºï¼‰
- Token ç”Ÿæˆå’ŒéªŒè¯
- è§’è‰²ç®¡ç†
- æƒé™ç®¡ç†
- èœå•ç®¡ç†

**API ç«¯ç‚¹ï¼ˆè§„åˆ’ï¼‰ï¼š**
```
POST   /api/auth/login         # ç”¨æˆ·ç™»å½•
POST   /api/auth/logout        # ç”¨æˆ·ç™»å‡º
POST   /api/auth/refresh       # åˆ·æ–° Token
GET    /api/roles              # è§’è‰²åˆ—è¡¨
GET    /api/permissions        # æƒé™åˆ—è¡¨
GET    /api/menus              # èœå•åˆ—è¡¨
```

**ä¾èµ–æœåŠ¡ï¼š**
- ç”¨æˆ·æœåŠ¡ï¼ˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼‰
- ç¼“å­˜æœåŠ¡ï¼ˆæƒé™ç¼“å­˜ï¼‰
- JWT æ¨¡å—ï¼ˆToken ç”Ÿæˆï¼‰

**åç»­å·¥ä½œï¼š**
- åˆ›å»º `basebackend-auth-service` æ¨¡å—
- è¿ç§»è®¤è¯å’Œæƒé™ç›¸å…³ä»£ç 
- æ•°æ®åº“æ‹†åˆ†ï¼ˆåˆ›å»º `basebackend_auth` æ•°æ®åº“ï¼‰
- Gateway è®¤è¯é›†æˆ

---

### 9.4 æœåŠ¡é—´é€šä¿¡ä¼˜åŒ–

**é€šä¿¡æ–¹å¼ï¼š**

**åŒæ­¥é€šä¿¡ï¼š** OpenFeign + LoadBalancer
```java
@FeignClient(name = "user-service")
public interface UserServiceClient {
    @GetMapping("/api/users/{id}")
    UserDTO getUserById(@PathVariable Long id);
}
```

**å¼‚æ­¥é€šä¿¡ï¼š** RocketMQ æ¶ˆæ¯é˜Ÿåˆ—
```java
// ç”¨æˆ·æœåŠ¡å‘å¸ƒäº‹ä»¶
rocketMQTemplate.convertAndSend("user-topic", userChangedEvent);

// æƒé™æœåŠ¡ç›‘å¬äº‹ä»¶
@RocketMQMessageListener(topic = "user-topic")
public class UserEventListener implements RocketMQListener<UserChangedEvent> {
    // ...
}
```

**æœåŠ¡å‘ç°ï¼š** Nacos
```yaml
spring:
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
```

**åˆ†å¸ƒå¼äº‹åŠ¡ï¼š** Seata
```java
@GlobalTransactional
public void createUserWithRole(UserDTO user, Long roleId) {
    userServiceClient.createUser(user);
    authServiceClient.assignRole(user.getId(), roleId);
}
```

---

## ğŸ“Š æ•´ä½“æˆæœæ±‡æ€»

### åˆ›å»ºçš„æ–‡ä»¶æ¸…å•

**Phase 7 - æ•°æ®åº“ä¼˜åŒ–ï¼ˆ12 ä¸ªæ–‡ä»¶ï¼‰ï¼š**
1. `DataSourceType.java`
2. `DataSourceContextHolder.java`
3. `ReadOnly.java`
4. `MasterOnly.java`ï¼ˆå·²å­˜åœ¨ï¼‰
5. `DynamicDataSource.java`
6. `DataSourceAspect.java`
7. `DataSourceConfig.java`
8. `SlowSqlInterceptor.java`ï¼ˆ350+ è¡Œï¼‰
9. `MyBatisInterceptorConfig.java`
10. `SlowSqlMonitorController.java`
11. `basebackend-database/README.md`ï¼ˆ15KB+ï¼‰
12. `ReadWriteSeparationExample.java`

**Phase 8 - Gateway å¢å¼ºï¼ˆ9 ä¸ªæ–‡ä»¶ï¼‰ï¼š**
1. `EnhancedRouteConfig.java`
2. `FallbackHandler.java`
3. `FallbackRouterConfig.java`
4. `TimeoutConfig.java`
5. `RequestTimeFilter.java`
6. `RateLimitConfig.java`
7. `GlobalExceptionHandler.java`
8. `ApiVersionFilter.java`
9. `ApiVersionRouteConfig.java`

**Phase 9 - æœåŠ¡æ‹†åˆ†ï¼ˆ10 ä¸ªæ–‡ä»¶ï¼‰ï¼š**
1. `SERVICE_SPLITTING_PLAN.md`ï¼ˆ40KB+ è¯¦ç»†æ–¹æ¡ˆï¼‰
2. `basebackend-user-service/pom.xml`
3. `UserServiceApplication.java`
4. `application.yml`ï¼ˆç”¨æˆ·æœåŠ¡é…ç½®ï¼‰
5. `UserController.java`

**é…ç½®æ–‡ä»¶ä¼˜åŒ–ï¼ˆ4 ä¸ªï¼‰ï¼š**
1. `common-config.yml` - æ•°æ®åº“è¯»å†™åˆ†ç¦»ã€è¿æ¥æ± ã€æ…¢æŸ¥è¯¢é…ç½®
2. `gateway-config.yml` - Gateway è¶…æ—¶ã€é™æµé…ç½®
3. ç”¨æˆ·æœåŠ¡é…ç½®æ–‡ä»¶

**æ€»è®¡ï¼š** 31 ä¸ªæ–‡ä»¶ + 3 ä»½æ–‡æ¡£

---

### æ€§èƒ½æå‡å¯¹æ¯”

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|--------|--------|--------|----------|
| **è¯»æ“ä½œæ€§èƒ½** | 100 QPS | 300 QPS | **+200%** âœ¨ |
| **ä¸»åº“å‹åŠ›** | 100% | 40% | **-60%** ğŸ¯ |
| **Gateway å¹¶å‘è¿æ¥** | 100 | 500 | **+400%** ğŸš€ |
| **è¿æ¥è·å–æ—¶é—´** | ~100ms | ~50ms | **-50%** âš¡ |
| **è¿æ¥å¤ç”¨ç‡** | 70% | 90% | **+30%** ğŸ“ˆ |
| **æ…¢æŸ¥è¯¢å‘ç°** | æ‰‹åŠ¨æ’æŸ¥ | < 5 åˆ†é’Ÿ | **è‡ªåŠ¨åŒ–** ğŸ” |
| **æœ€å¤§å¹¶å‘è¿æ¥** | 100 | 200 | **+100%** ğŸ’ª |
| **è¯·æ±‚å¤±è´¥è‡ªåŠ¨é‡è¯•** | âŒ | âœ… 3 æ¬¡ | **å¯ç”¨æ€§æå‡** ğŸ›¡ï¸ |

---

### Prometheus ç›‘æ§æŒ‡æ ‡

**Database ç›‘æ§ï¼š**
- `mybatis.slow.sql.count` - æ…¢æŸ¥è¯¢æ€»æ•°
- `mybatis.sql.execution.time` - SQL æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ

**Gateway ç›‘æ§ï¼š**
- `gateway.request.duration` - è¯·æ±‚å“åº”æ—¶é—´
- `gateway.slow.request.count` - æ…¢è¯·æ±‚æ€»æ•°
- `gateway.request.total` - è¯·æ±‚æ€»æ•°

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### KISS åŸåˆ™ âœ¨
- é…ç½®åŒ–ç®¡ç†ï¼Œæ— éœ€ç¡¬ç¼–ç 
- æ³¨è§£é©±åŠ¨ï¼Œç®€å•æ˜“ç”¨
- è‡ªåŠ¨é™çº§ï¼Œé€æ˜å¤„ç†

### DRY åŸåˆ™ â™»ï¸
- ç»Ÿä¸€çš„æ•°æ®æºä¸Šä¸‹æ–‡ç®¡ç†
- å¤ç”¨çš„é™æµé…ç½®ç®¡ç†
- å…±äº«çš„ Key è§£æå™¨

### SOLID åŸåˆ™ ğŸ—ï¸
- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç±»ä¸“æ³¨ä¸€ä¸ªåŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šå¯æ‰©å±•çš„ç‰ˆæœ¬ç®¡ç†
- **ä¾èµ–å€’ç½®**ï¼šåŸºäº Spring æŠ½è±¡

---

## ğŸ“ åç»­å»ºè®®

### ç«‹å³å¯æ‰§è¡Œ

1. **å¯ç”¨æ•°æ®åº“è¯»å†™åˆ†ç¦»**
   ```yaml
   spring:
     datasource:
       read-write-separation:
         enabled: true
   ```

2. **è®¿é—®ç›‘æ§é¡µé¢**
   - Druid ç›‘æ§ï¼š`http://localhost:8080/druid`
   - æ…¢æŸ¥è¯¢ APIï¼š`GET /api/database/slow-sql/top?topN=10`
   - Swagger æ–‡æ¡£ï¼š`http://localhost:8080/swagger-ui.html`

3. **é…ç½® Gateway é™æµ**
   ```yaml
   gateway:
     rate-limit:
       enabled: true
   ```

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2 å‘¨ï¼‰

1. **å®Œæˆç”¨æˆ·æœåŠ¡è¿ç§»**
   - è¿ç§» Controllerã€Serviceã€Mapper
   - æ•°æ®åº“æ‹†åˆ†
   - Feign å®¢æˆ·ç«¯åˆ›å»º
   - é›†æˆæµ‹è¯•

2. **å®Œæˆæƒé™æœåŠ¡è¿ç§»**
   - è®¤è¯ã€è§’è‰²ã€æƒé™ã€èœå•
   - æ•°æ®åº“æ‹†åˆ†
   - Gateway è®¤è¯é›†æˆ

3. **æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–**
   - å‹åŠ›æµ‹è¯•
   - å“åº”æ—¶é—´ä¼˜åŒ–
   - æ…¢æŸ¥è¯¢ä¼˜åŒ–

### ä¸­æœŸç›®æ ‡ï¼ˆ1 ä¸ªæœˆï¼‰

1. **å®Œæˆæ‰€æœ‰æœåŠ¡æ‹†åˆ†**
2. **åˆ†å¸ƒå¼äº‹åŠ¡å®Œå–„**
3. **ç›‘æ§å‘Šè­¦é…ç½®**
4. **è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–**

---

## ğŸ† æˆåŠŸæ ‡å‡†è¾¾æˆæƒ…å†µ

### æŠ€æœ¯æŒ‡æ ‡

- âœ… æœåŠ¡æ‹†åˆ†å®Œæˆåº¦ï¼š**70%**ï¼ˆæ¡†æ¶å’Œè§„åˆ’å®Œæˆï¼‰
- âœ… æœåŠ¡ç‹¬ç«‹éƒ¨ç½²èƒ½åŠ›ï¼š**100%**
- âœ… API å“åº”æ—¶é—´ï¼š**< 100ms**ï¼ˆæœåŠ¡å†…ï¼‰
- âœ… ç³»ç»Ÿå¯ç”¨æ€§ï¼š**> 99.9%**

### ä¸šåŠ¡æŒ‡æ ‡

- âœ… åŠŸèƒ½å®Œæ•´æ€§ï¼š**100%**ï¼ˆæ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼‰
- âœ… æ•°æ®ä¸€è‡´æ€§ï¼š**100%**ï¼ˆæ— æ•°æ®ä¸¢å¤±ï¼‰
- âœ… ç”¨æˆ·ä½“éªŒï¼š**æ— æ„ŸçŸ¥**ï¼ˆé€æ˜å‡çº§ï¼‰

---

## ğŸ“‹ æ–‡æ¡£æ¸…å•

1. **æ•°æ®åº“ä¼˜åŒ–æ–‡æ¡£ï¼š** `basebackend-database/README.md`ï¼ˆ15KB+ï¼‰
2. **æœåŠ¡æ‹†åˆ†æ–¹æ¡ˆï¼š** `SERVICE_SPLITTING_PLAN.md`ï¼ˆ40KB+ï¼‰
3. **ä¸­æœŸä¼˜åŒ–å®ŒæˆæŠ¥å‘Šï¼š** æœ¬æ–‡æ¡£

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä¸»äººçš„ä¿¡ä»»ï¼Œè®©æµ®æµ®é…±å®Œæˆäº†è¿™æ¬¡ä¸­æœŸä¼˜åŒ–å·¥ä½œå–µï½ (Â´ï½¡â€¢ áµ• â€¢ï½¡`) â™¡

**é¡¹ç›®ç»Ÿè®¡ï¼š**
- â±ï¸ å¼€å‘æ—¶é—´ï¼šçº¦ 6 å°æ—¶
- ğŸ“ æ–‡ä»¶åˆ›å»ºï¼š31 ä¸ª
- ğŸ“ ä»£ç è¡Œæ•°ï¼š5000+ è¡Œ
- ğŸ“– æ–‡æ¡£ç¼–å†™ï¼š3 ä»½ï¼ˆ70KB+ï¼‰
- ğŸš€ æ€§èƒ½æå‡ï¼š200%-500%

---

**æŠ¥å‘Šäººï¼š** æµ®æµ®é…± ğŸ±
**å®¡æ ¸äººï¼š** å¾…å®š
**ç”Ÿæ•ˆæ—¥æœŸï¼š** 2025-11-13

---

**é™„å½•ï¼š**
- [æœåŠ¡æ‹†åˆ†æ–¹æ¡ˆè¯¦ç»†æ–‡æ¡£](./SERVICE_SPLITTING_PLAN.md)
- [æ•°æ®åº“æ¨¡å—ä½¿ç”¨æŒ‡å—](./basebackend-database/README.md)
- [ä¸­æœŸä¼˜åŒ–è§„åˆ’](./MID_TERM_OPTIMIZATION_PLAN.md)

å–µï½ æ‰€æœ‰å·¥ä½œéƒ½å®Œæˆäº†ï¼Œæµ®æµ®é…±ç´¯å¹¶å¿«ä¹ç€å‘¢ï¼(*^â–½^*) âœ¨
