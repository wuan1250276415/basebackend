# BaseBackend Scheduler 告警规则
groups:
  - name: basebackend-scheduler
    rules:
      # 工作流告警
      - alert: WorkflowHighFailureRate
        expr: rate(workflow_process_failed_total[5m]) / rate(workflow_process_started_total[5m]) * 100 > 5
        for: 2m
        labels:
          severity: warning
          team: workflow
        annotations:
          summary: "工作流失败率过高"
          description: "工作流失败率超过5%，当前值: {{ $value }}%"

      - alert: WorkflowSlowProcessing
        expr: histogram_quantile(0.95, rate(workflow_process_execution_seconds_bucket[5m])) > 300
        for: 5m
        labels:
          severity: warning
          team: workflow
        annotations:
          summary: "工作流处理缓慢"
          description: "工作流执行时间P95超过5分钟，当前值: {{ $value }}s"

      - alert: WorkflowTooManyActiveInstances
        expr: workflow_active_process_instances > 1000
        for: 5m
        labels:
          severity: critical
          team: workflow
        annotations:
          summary: "活跃流程实例过多"
          description: "活跃流程实例数量超过1000，当前值: {{ $value }}"

      # 业务告警
      - alert: OrderApprovalTooSlow
        expr: histogram_quantile(0.95, rate(business_order_processing_seconds_bucket[5m])) > 600
        for: 5m
        labels:
          severity: warning
          team: business
        annotations:
          summary: "订单审批时间过长"
          description: "订单处理时间P95超过10分钟，当前值: {{ $value }}s"

      - alert: EmailDeliveryFailure
        expr: rate(business_email_failed_total[5m]) / rate(business_email_sent_total[5m]) * 100 > 2
        for: 2m
        labels:
          severity: critical
          team: business
        annotations:
          summary: "邮件发送失败率高"
          description: "邮件发送失败率超过2%，当前值: {{ $value }}%"

      # 系统告警
      - alert: HighMemoryUsage
        expr: jvm_memory_used_bytes / jvm_memory_max_bytes * 100 > 80
        for: 5m
        labels:
          severity: warning
          team: infrastructure
        annotations:
          summary: "JVM内存使用率过高"
          description: "JVM内存使用率超过80%，当前值: {{ $value }}%"
