# Camunda BPMN 工作流引擎配置

# Camunda 数据源配置（可选，默认使用 Spring 主数据源）
# 如果需要独立数据源，取消下面的注释
# spring:
#   datasource:
#     url: ${CAMUNDA_DATASOURCE_URL:jdbc:mysql://localhost:3306/basebackend?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true}
#     username: ${CAMUNDA_DATASOURCE_USERNAME:root}
#     password: ${CAMUNDA_DATASOURCE_PASSWORD:root}
#     driver-class-name: com.mysql.cj.jdbc.Driver

camunda:
  bpm:
    # 管理员用户配置（安全提示：生产环境必须通过环境变量提供密码）
    admin-user:
      id: admin
      password: ${CAMUNDA_ADMIN_PASSWORD:}
      first-name: Scheduler
      last-name: Admin
      email: admin@basebackend.com

    # 默认过滤器
    filter:
      create: All tasks

    # Web 应用配置
    webapp:
      # Web UI 访问路径
      application-path: /camunda
      # 是否启用首页重定向
      index-redirect-enabled: true

    # 数据库配置
    database:
      # 数据库类型: mysql, h2, postgres 等
      type: ${CAMUNDA_DATABASE_TYPE:mysql}
      # Schema 更新策略: true=自动创建/更新表, false=禁用(使用 Flyway)
      # 开发环境建议设为 true，生产环境设为 false
      schema-update: ${CAMUNDA_SCHEMA_UPDATE:true}

    # 历史级别（none/activity/audit/full）
    # full: 记录所有历史信息，包括变量更新
    history-level: full

    # 暂时禁用自动部署 BPMN 流程定义（BPMN 文件需要修复）
    auto-deployment-enabled: false
    
    # 通用属性（注意：只能有一个 generic-properties 块，否则会被覆盖）
    generic-properties:
      properties:
        # 禁用 History TTL 强制检查（重要：允许部署没有设置 historyTimeToLive 的流程）
        enforceHistoryTimeToLive: false
        # 设置默认的历史数据保留时间（天）
        historyTimeToLiveString: P180D
        # 启用权限检查
        authorizationEnabled: true
        # 禁用遥测
        initializeTelemetry: false
        # 作业执行器配置
        jobExecutorActivate: true
        jobExecutorDeploymentAware: true
        # 异步执行器配置
        asyncExecutorActivate: true
        asyncExecutorCorePoolSize: 4
        asyncExecutorMaxPoolSize: 10
        # 失败作业重试时间周期
        failedJobRetryTimeCycle: R3/PT5M

# Spring Jackson 配置（Camunda 需要）
spring:
  jackson:
    date-format: yyyy-MM-dd'T'HH:mm:ss.SSSXXX
    time-zone: Asia/Shanghai
    serialization:
      write-dates-as-timestamps: false
      fail-on-empty-beans: false
    deserialization:
      fail-on-unknown-properties: false
  # JPA 配置：启用自动建表
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
        format_sql: true
