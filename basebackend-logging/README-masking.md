# PIIæ•°æ®è„±æ•å¢å¼ºå™¨

## ğŸ“– æ¦‚è¿°

PIIæ•°æ®è„±æ•å¢å¼ºå™¨æ˜¯ä¸“ä¸º basebackend-logging æ¨¡å—è®¾è®¡çš„æ•°æ®å®‰å…¨ç»„ä»¶ï¼Œé€šè¿‡è‡ªåŠ¨è¯†åˆ«å’Œè„±æ•æ•æ„Ÿä¿¡æ¯ï¼Œæœ‰æ•ˆé˜²æ­¢ä¸ªäººä¿¡æ¯æ³„éœ²ï¼Œæ»¡è¶³åˆè§„è¦æ±‚ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **å¤šç§æ•æ„Ÿæ•°æ®ç±»å‹**ï¼šæ”¯æŒæ‰‹æœºå·ã€èº«ä»½è¯ã€é“¶è¡Œå¡ã€é‚®ç®±ç­‰
- âœ… **å¤šç§è„±æ•ç­–ç•¥**ï¼šæ©ç ã€éƒ¨åˆ†ã€å“ˆå¸Œã€ç§»é™¤ã€è‡ªå®šä¹‰
- âœ… **å¤šç»´åº¦åŒ¹é…**ï¼šæ­£åˆ™è¡¨è¾¾å¼ + JSONè·¯å¾„
- âœ… **é«˜æ€§èƒ½**ï¼šå¤„ç†æ—¶é—´<5ms/æ¡ï¼Œå‡†ç¡®ç‡>99%
- âœ… **è‡ªåŠ¨è„±æ•**ï¼šæ³¨è§£å¼ä½¿ç”¨ + æ—¥å¿—è¾“å‡ºè‡ªåŠ¨è„±æ•
- âœ… **é…ç½®çµæ´»**ï¼šæ”¯æŒè‡ªå®šä¹‰è§„åˆ™å’Œçƒ­æ›´æ–°

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| **å¤„ç†æ—¶é—´** | <5ms/æ¡ | å•æ¡æ—¥å¿—è„±æ•è€—æ—¶ |
| **å‡†ç¡®ç‡** | >99% | æ•æ„Ÿä¿¡æ¯è¯†åˆ«å‡†ç¡®ç‡ |
| **å†…å­˜ä½¿ç”¨** | å¯æ§ | é¢„ç¼–è¯‘æ­£åˆ™ï¼Œé¿å…é¢‘ç¹å¯¹è±¡åˆ›å»º |

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                PIIè„±æ•ç³»ç»Ÿæ¶æ„                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Application Layer                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚ @DataMasking â”‚  â”‚   Log Output â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                 â”‚                              â”‚
â”‚            â–¼                 â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               AOP åˆ‡é¢å±‚                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  PiiMaskingAspect                           â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - è§£æ@DataMaskingæ³¨è§£                      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  - è°ƒç”¨è„±æ•æœåŠ¡                              â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                  â”‚
â”‚                         â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              PiiMaskingService                       â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  æ­£åˆ™åŒ¹é…å¼•æ“      â”‚  â”‚   JSONè·¯å¾„åŒ¹é…å¼•æ“   â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - æ‰‹æœºå·         â”‚  â”‚   - user.phone       â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - èº«ä»½è¯         â”‚  â”‚   - order.creditCard â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - é“¶è¡Œå¡         â”‚  â”‚   - customer.email   â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  - é‚®ç®±           â”‚  â”‚                      â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚          â”‚                          â”‚               â”‚  â”‚
â”‚  â”‚          â–¼                          â–¼               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚        è„±æ•ç­–ç•¥æ‰§è¡Œå™¨                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ MASK  â”‚ â”‚ PARTIALâ”‚ â”‚ HASH   â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ æ©ç   â”‚ â”‚ éƒ¨åˆ†   â”‚ â”‚ å“ˆå¸Œ   â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                  â”‚
â”‚                         â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 æ•°æ®å±‚                                â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  åŸå§‹æ•°æ®               è„±æ•åæ•°æ®                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚  â”‚
â”‚  â”‚  â”‚13812345678â”‚    â†’    â”‚138****5678â”‚                  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ ä¾èµ–

ç¡®ä¿ `basebackend-logging` æ¨¡å—å·²æ­£ç¡®å¼•å…¥ã€‚

### 2. é…ç½®è„±æ•è§„åˆ™

åœ¨ `application.yml` ä¸­é…ç½®ï¼š

```yaml
basebackend:
  logging:
    masking:
      enabled: true
      slow-threshold-millis: 5
      ignore-loggers:
        - "org.hibernate.SQL"
      rules:
        - name: phone
          regex: "\\b1\\d{10}\\b"
          strategy: PARTIAL
          prefix-keep: 3
          suffix-keep: 2
        - name: email
          regex: "[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+"
          strategy: MASK
          prefix-keep: 2
          suffix-keep: 6
        - name: card
          regex: "\\b\\d{16,19}\\b"
          strategy: PARTIAL
          prefix-keep: 4
          suffix-keep: 4
        - name: nested-phone
          json-path: "user.contact.phone"
          strategy: PARTIAL
          prefix-keep: 3
          suffix-keep: 2
```

### 3. é…ç½®Logbackè¾“å‡ºè„±æ•

åœ¨ `logback-spring.xml` ä¸­æ·»åŠ è½¬æ¢è§„åˆ™ï¼š

```xml
<configuration>
    <!-- å£°æ˜è„±æ•è½¬æ¢å™¨ -->
    <conversionRule conversionWord="maskMsg"
                    converterClass="com.basebackend.logging.masking.MaskingMessageConverter"/>

    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <!-- ä½¿ç”¨è„±æ•è½¬æ¢å™¨ -->
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger - %maskMsg%n</pattern>
        </encoder>
    </appender>

    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
    </root>
</configuration>
```

### 4. ä½¿ç”¨æ³¨è§£è„±æ•

```java
@Service
public class UserService {

    /**
     * æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆè‡ªåŠ¨è„±æ•ï¼‰
     */
    @DataMasking
    public UserInfo getUserInfo(Long userId) {
        // è¿”å›åŒ…å«æ•æ„Ÿä¿¡æ¯çš„ç”¨æˆ·å¯¹è±¡
        return userRepository.findById(userId);
    }

    /**
     * æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼ˆéƒ¨åˆ†è„±æ•è§„åˆ™ï¼‰
     */
    @DataMasking(ruleNames = {"phone", "email"})
    public List<UserInfo> getUserList() {
        return userRepository.findAll();
    }

    /**
     * è·å–è„±æ•ç”¨æˆ·æ—¥å¿—ï¼ˆè·³è¿‡nullå€¼ï¼‰
     */
    @DataMasking(skipNull = true)
    public UserLog getUserLog(Long userId) {
        return userLogRepository.findByUserId(userId);
    }
}
```

## âš™ï¸ é…ç½®å‚æ•°è¯¦è§£

### åŸºç¡€é…ç½®

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `enabled` | boolean | true | æ˜¯å¦å¯ç”¨è„±æ•åŠŸèƒ½ |
| `slow-threshold-millis` | long | 5 | æ…¢è„±æ•é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…è¿‡æ­¤å€¼ä¼šè®°å½•è­¦å‘Š |
| `ignore-loggers` | List<String> | [] | å¿½ç•¥çš„æ—¥å¿—å™¨åç§° |

### è„±æ•è§„åˆ™é…ç½®

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `name` | String | **å¿…éœ€** | è§„åˆ™åç§° |
| `regex` | String | null | æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå­—ç¬¦ä¸²åŒ¹é…ï¼‰ |
| `json-path` | String | null | JSONè·¯å¾„ï¼ˆå¯¹è±¡å­—æ®µåŒ¹é…ï¼‰ |
| `strategy` | Enum | MASK | è„±æ•ç­–ç•¥ |
| `replacement` | String | "*" | æ›¿æ¢å­—ç¬¦ |
| `prefix-keep` | int | 3 | ä¿ç•™å‰ç¼€å­—ç¬¦æ•° |
| `suffix-keep` | int | 2 | ä¿ç•™åç¼€å­—ç¬¦æ•° |
| `enabled` | boolean | true | æ˜¯å¦å¯ç”¨è§„åˆ™ |

## ğŸ“Š è„±æ•ç­–ç•¥è¯¦è§£

### MASKï¼ˆæ©ç ï¼‰

**è¡Œä¸º**ï¼šå…¨éƒ¨æ›¿æ¢ä¸ºæŒ‡å®šå­—ç¬¦

**ç¤ºä¾‹**ï¼š
```
åŸå€¼ï¼š13812345678
è„±æ•ï¼š**********
```

**é…ç½®**ï¼š
```yaml
strategy: MASK
replacement: "*"
```

### PARTIALï¼ˆéƒ¨åˆ†ä¿ç•™ï¼‰

**è¡Œä¸º**ï¼šä¿ç•™å‰ç¼€å’Œåç¼€ï¼Œä¸­é—´éƒ¨åˆ†è„±æ•

**ç¤ºä¾‹**ï¼š
```
åŸå€¼ï¼š13812345678
è„±æ•ï¼š138****5678
```

**é…ç½®**ï¼š
```yaml
strategy: PARTIAL
prefix-keep: 3
suffix-keep: 4
replacement: "*"
```

### HASHï¼ˆå“ˆå¸Œï¼‰

**è¡Œä¸º**ï¼šä½¿ç”¨SHA-256å“ˆå¸Œå€¼æ›¿æ¢åŸå€¼

**ç¤ºä¾‹**ï¼š
```
åŸå€¼ï¼š13812345678
è„±æ•ï¼ša665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3
```

**é…ç½®**ï¼š
```yaml
strategy: HASH
```

### REMOVEï¼ˆç§»é™¤ï¼‰

**è¡Œä¸º**ï¼šå®Œå…¨ç§»é™¤æ•æ„Ÿå­—æ®µ

**ç¤ºä¾‹**ï¼š
```
åŸå€¼ï¼š13812345678
è„±æ•ï¼šï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰
```

**é…ç½®**ï¼š
```yaml
strategy: REMOVE
```

### CUSTOMï¼ˆè‡ªå®šä¹‰ï¼‰

**è¡Œä¸º**ï¼šä½¿ç”¨è‡ªå®šä¹‰å­—ç¬¦ä¸²æ›¿æ¢

**ç¤ºä¾‹**ï¼š
```
åŸå€¼ï¼š13812345678
è„±æ•ï¼šå·²è„±æ•
```

**é…ç½®**ï¼š
```yaml
strategy: CUSTOM
replacement: "å·²è„±æ•"
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### 1. JSONè·¯å¾„è„±æ•

```java
public class OrderInfo {
    private UserInfo user;  // åŒ…å«æ•æ„Ÿä¿¡æ¯
    private String orderId;
    private BigDecimal amount;
}

// åœ¨é…ç½®ä¸­æŒ‡å®šJSONè·¯å¾„
rules:
  - name: "user-phone"
    json-path: "user.phone"
    strategy: PARTIAL
    prefix-keep: 3
    suffix-keep: 2
```

### 2. è‡ªå®šä¹‰è§„åˆ™

```yaml
rules:
  - name: "custom-sensitive"
    regex: "secret:\\w+"
    strategy: CUSTOM
    replacement: "secret:[å·²è„±æ•]"
```

### 3. å¤šè§„åˆ™ç»„åˆ

```java
@DataMasking(ruleNames = {"phone", "email", "id-card"})
public UserInfo getUserInfo(Long userId) {
    return userRepository.findById(userId);
}
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### 1. é€šè¿‡ä»£ç è·å–æŒ‡æ ‡

```java
@Autowired
private MaskingProperties properties;

@Autowired
private PiiMaskingService service;

public void printMetrics() {
    MaskingMetrics metrics = service.getMetrics();
    System.out.println(metrics.getSummary());
}
```

### 2. é€šè¿‡ Micrometer é›†æˆ

```java
@Component
public class MaskingMetrics {

    private final PiiMaskingService service;

    public MaskingMetrics(PiiMaskingService service) {
        this.service = service;
        // æ³¨å†ŒæŒ‡æ ‡
        MeterRegistry.registry.gauge("logging.masking.rate",
            service, s -> s.getMetrics().getMaskingRate());
        MeterRegistry.registry.gauge("logging.masking.avg.micros",
            service, s -> (double) s.getMetrics().getAvgMicros());
    }
}
```

### 3. å…³é”®æŒ‡æ ‡è¯´æ˜

| æŒ‡æ ‡ | ç±»å‹ | è¯´æ˜ | æ­£å¸¸èŒƒå›´ |
|------|------|------|----------|
| `masked` | Counter | å·²è„±æ•æ¬¡æ•° | æŒç»­å¢é•¿ |
| `hits` | Counter | æ€»è¯·æ±‚æ•° | æŒç»­å¢é•¿ |
| `avgMicros` | Gauge | å¹³å‡è„±æ•æ—¶é—´ï¼ˆå¾®ç§’ï¼‰ | < 5000 |
| `maskingRate` | Gauge | è„±æ•ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰ | 0-100% |

## ğŸ”§ æ€§èƒ½è°ƒä¼˜

### 1. è°ƒæ•´è§„åˆ™ä¼˜å…ˆçº§

å°†æœ€å¸¸ç”¨çš„è§„åˆ™æ”¾åœ¨å‰é¢ï¼Œæé«˜åŒ¹é…æ•ˆç‡ï¼š

```yaml
rules:
  # æœ€å¸¸ç”¨çš„è§„åˆ™æ”¾å‰é¢
  - name: "phone"      # é«˜é¢‘åŒ¹é…
    regex: "\\b1\\d{10}\\b"
    strategy: PARTIAL

  - name: "email"      # ä¸­é¢‘åŒ¹é…
    regex: "[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+"
    strategy: MASK
```

### 2. ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼

**âœ… æ¨è**ï¼š
```yaml
# ä½¿ç”¨ç²¾ç¡®åŒ¹é…
regex: "\\b1\\d{10}\\b"
```

**âŒ é¿å…**ï¼š
```yaml
# é¿å…è´ªå©ªåŒ¹é…
regex: "1.*\\d{10}.*"
```

### 3. ç¦ç”¨ä¸å¿…è¦çš„è§„åˆ™

```yaml
# å¦‚æœä¸éœ€è¦JSONè·¯å¾„è„±æ•ï¼Œå¯ä»¥ç§»é™¤
rules:
  # ä»…ä½¿ç”¨æ­£åˆ™è„±æ•
  - name: "phone"
    regex: "\\b1\\d{10}\\b"
    strategy: PARTIAL
```

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. è„±æ•ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥**ï¼š
- é…ç½®æ˜¯å¦æ­£ç¡®åŠ è½½
- æ³¨è§£æ˜¯å¦æ·»åŠ 
- æœåŠ¡æ˜¯å¦å¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# å¯ç”¨DEBUGæ—¥å¿—
logging:
  level:
    com.basebackend.logging.masking: DEBUG
```

#### 2. æ€§èƒ½é—®é¢˜

**åŸå› **ï¼š
- æ­£åˆ™è¡¨è¾¾å¼è¿‡äºå¤æ‚
- è§„åˆ™æ•°é‡è¿‡å¤š
- å•æ¬¡å¤„ç†æ•°æ®é‡è¿‡å¤§

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼
# å‡å°‘è§„åˆ™æ•°é‡
# è°ƒæ•´slow-threshold-millis
```

#### 3. å†…å­˜ä½¿ç”¨è¿‡é«˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# å‡å°‘è§„åˆ™å¤æ‚åº¦
# æ§åˆ¶æ—¥å¿—å¤§å°
# é€‚å½“è°ƒæ•´MAX_BUFFER
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. è§„åˆ™å‘½åè§„èŒƒ

```yaml
# âœ… æ¨èï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
- name: "phone"
- name: "id-card"
- name: "bank-card"

# âŒ é¿å…ï¼šä½¿ç”¨ç®€å•ä»£å·
- name: "rule1"
- name: "rule2"
```

### 2. ç­–ç•¥é€‰æ‹©åŸåˆ™

- **æ‰‹æœºå·/èº«ä»½è¯/é“¶è¡Œå¡**ï¼šä½¿ç”¨PARTIALç­–ç•¥
- **é‚®ç®±**ï¼šä½¿ç”¨MASKç­–ç•¥
- **å¯†ç /å¯†é’¥**ï¼šä½¿ç”¨HASHç­–ç•¥
- **æåº¦æ•æ„Ÿä¿¡æ¯**ï¼šä½¿ç”¨REMOVEç­–ç•¥

### 3. ç›‘æ§å»ºè®®

- **å¿…ç›‘æ§æŒ‡æ ‡**ï¼šavgMicrosã€maskingRate
- **å‘Šè­¦é˜ˆå€¼**ï¼š
  - avgMicros > 5000Î¼s
  - maskingRate < 10%ï¼ˆå¯èƒ½è§„åˆ™æœªç”Ÿæ•ˆï¼‰

### 4. åˆè§„è¦æ±‚

- **ç­‰ä¿2.0**ï¼šå¿…é¡»å¯¹ä¸ªäººä¿¡æ¯è¿›è¡Œè„±æ•
- **GDPR**ï¼šå¿…é¡»å¯¹æ¬§ç›Ÿå±…æ°‘ä¿¡æ¯è„±æ•
- **PCI DSS**ï¼šå¿…é¡»å¯¹æ”¯ä»˜å¡ä¿¡æ¯è„±æ•

## ğŸ”— ç›¸å…³èµ„æº

- [Spring AOP æ–‡æ¡£](https://docs.spring.io/spring-framework/reference/core/aop.html)
- [æ­£åˆ™è¡¨è¾¾å¼è¯¦è§£](https://www.oracle.com/technical-resources/articles/java/regex.html)
- [basebackend-logging ä¸»é¡µ](./README.md)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª Apache License 2.0 è®¸å¯è¯ã€‚

---

**æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œæ›´æ–°ï¼Œè¯·è®¿é—® [basebackend é¡¹ç›®ä¸»é¡µ](https://github.com/basebackend/basebackend)**
