# ================================================================================================
# RocketMQ 消息队列配置 (RocketMQ Config)
# ================================================================================================
#
# 包含内容：
# - RocketMQ 基础配置
# - 生产者和消费者配置
# - 消息重试、死信队列、幂等性配置
#
# ================================================================================================

# Spring RocketMQ 配置
rocketmq:
  name-server: ${ROCKETMQ_NAME_SERVER:localhost:9876}
  producer:
    group: basebackend-producer-group
    send-message-timeout: 3000
    compress-message-body-threshold: 4096
    max-message-size: 4194304  # 4MB
    retry-times-when-send-failed: 2
    retry-times-when-send-async-failed: 2
    retry-next-server: false
  consumer:
    group: basebackend-consumer-group
    consume-timeout: 15

# 消息配置
messaging:
  # RocketMQ 配置
  rocketmq:
    enabled: true
    default-topic: basebackend-topic
    topic-prefix: basebackend.

  # 重试配置
  retry:
    enabled: true
    max-attempts: 16
    # RocketMQ 延迟级别：1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h

  # 死信队列配置
  dead-letter:
    enabled: true
    topic: basebackend-dlq-topic
    consumer-group: basebackend-dlq-consumer-group

  # 事务消息配置
  transaction:
    enabled: true
    table-name: sys_message_log
    check-interval: 60
    timeout: 30

  # 幂等性配置
  idempotency:
    enabled: true
    expire-time: 3600
    key-prefix: "msg:idempotent:"
