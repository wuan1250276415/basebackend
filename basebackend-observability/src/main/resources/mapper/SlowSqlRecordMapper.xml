<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.basebackend.observability.mapper.SlowSqlRecordMapper">

    <select id="selectByTimeRange" resultType="com.basebackend.observability.entity.SlowSqlRecord">
        SELECT * FROM slow_sql_record
        WHERE timestamp BETWEEN #{startTime} AND #{endTime}
        ORDER BY duration DESC
    </select>

    <select id="selectTopSlowSql" resultType="com.basebackend.observability.entity.SlowSqlRecord">
        SELECT * FROM slow_sql_record
        ORDER BY duration DESC
        LIMIT #{limit}
    </select>

    <select id="aggregateByMethod" resultType="map">
        SELECT 
            method_name as methodName,
            COUNT(*) as count,
            AVG(duration) as avgDuration,
            MAX(duration) as maxDuration,
            MIN(duration) as minDuration
        FROM slow_sql_record
        WHERE timestamp BETWEEN #{startTime} AND #{endTime}
        GROUP BY method_name
        ORDER BY avgDuration DESC
    </select>

</mapper>
