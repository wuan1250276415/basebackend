# Phase 13: å¯è§‚æµ‹æ€§å¢å¼ºå®æ–½å®ŒæˆæŠ¥å‘Š

## æ¦‚è¿°

æœ¬æŠ¥å‘Šæ€»ç»“BaseBackendé¡¹ç›®åœ¨Phase 13: å¯è§‚æµ‹æ€§å¢å¼ºé˜¶æ®µçš„å®æ–½æˆæœï¼Œæ„å»ºäº†å®Œæ•´çš„**å¯è§‚æµ‹æ€§ä¸‰æ”¯æŸ±**ä½“ç³»ï¼ˆé“¾è·¯è¿½è¸ªã€æ—¥å¿—ã€æŒ‡æ ‡ï¼‰ï¼Œå®ç°äº†ç«¯åˆ°ç«¯çš„ç›‘æ§å’Œè¯Šæ–­èƒ½åŠ›ã€‚

**å®æ–½æ—¥æœŸ**: 2025å¹´11æœˆ15æ—¥
**å®æ–½é˜¶æ®µ**: Phase 13: å¯è§‚æµ‹æ€§å¢å¼º
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## 1. å®æ–½æˆæœæ€»è§ˆ

### 1.1 æ ¸å¿ƒç»„ä»¶

âœ… **åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª** - Jaeger + OpenTelemetry
âœ… **æ—¥å¿—èšåˆå¢å¼º** - ELK Stack + ç»“æ„åŒ–æ—¥å¿—
âœ… **è‡ªå®šä¹‰æŒ‡æ ‡ç›‘æ§** - Prometheus + Micrometer + Grafana
âœ… **APMé›†æˆ** - SkyWalking åº”ç”¨æ€§èƒ½ç›‘æ§
âœ… **ç«¯åˆ°ç«¯è¿½è¸ª** - æ•´åˆæ—¥å¿—ã€æŒ‡æ ‡ã€é“¾è·¯è¿½è¸ª

### 1.2 æŠ€æœ¯æ¶æ„

```
[åº”ç”¨å±‚]
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯è§‚æµ‹æ€§ä¸‰æ”¯æŸ±                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ é“¾è·¯è¿½è¸ª     â”‚  æ—¥å¿—èšåˆ    â”‚  æŒ‡æ ‡ç›‘æ§    â”‚        â”‚
â”‚  â”‚  Jaeger     â”‚  ELK Stack   â”‚ Prometheus  â”‚        â”‚
â”‚  â”‚  OpenTelemetryâ”‚ Filebeat    â”‚ Grafana     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[å­˜å‚¨å±‚]
    Elasticsearch - å­˜å‚¨æ—¥å¿—ã€é“¾è·¯æ•°æ®ã€æŒ‡æ ‡æ•°æ®

[å¯è§†åŒ–å±‚]
    Jaeger UI - é“¾è·¯è¿½è¸ªå¯è§†åŒ–
    Kibana - æ—¥å¿—åˆ†æå¯è§†åŒ–
    Grafana - æŒ‡æ ‡ç›‘æ§ä»ªè¡¨æ¿
```

---

## 2. åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª (Jaeger + OpenTelemetry)

### 2.1 å®æ–½å†…å®¹

#### âœ… Jaeger All-in-One éƒ¨ç½²
- **é…ç½®æ–‡ä»¶**: `deployment/devops/observability/jaeger/jaeger-all-in-one.yaml`
- **ç»„ä»¶**:
  - Jaeger Collector (æ”¶é›†é“¾è·¯æ•°æ®)
  - Jaeger Query (æŸ¥è¯¢é“¾è·¯æ•°æ®)
  - Jaeger UI (å¯è§†åŒ–ç•Œé¢)
  - Elasticsearch (å­˜å‚¨åç«¯)

#### âœ… OpenTelemetry Collector é…ç½®
- **é…ç½®æ–‡ä»¶**: `deployment/devops/observability/opentelemetry/collector-config.yaml`
- **åŠŸèƒ½**:
  - æ¥æ”¶å¤šç§æ•°æ®æº (OTLP, Jaeger, Zipkin)
  - å¤„ç†å’Œè½¬æ¢é“¾è·¯æ•°æ®
  - å¯¼å‡ºåˆ°å¤šä¸ªç›®æ ‡ (Jaeger, Elasticsearch)
  - DaemonSet éƒ¨ç½²æ”¶é›†ä¸»æœºæŒ‡æ ‡

#### âœ… åº”ç”¨é›†æˆä»£ç 
- **TracingConfig.java** - OpenTelemetry é…ç½®ç±»
- **TracingInterceptor.java** - HTTP è¯·æ±‚æ‹¦æˆªå™¨
- **TracingUtil.java** - é“¾è·¯è¿½è¸ªå·¥å…·ç±»
- **TracingAutoConfiguration.java** - è‡ªåŠ¨é…ç½®ç±»

### 2.2 æ ¸å¿ƒç‰¹æ€§

1. **è‡ªåŠ¨é“¾è·¯è¿½è¸ª**
   - HTTP è¯·æ±‚é“¾è·¯
   - æ•°æ®åº“æŸ¥è¯¢é“¾è·¯
   - Feign è°ƒç”¨é“¾è·¯
   - è‡ªå®šä¹‰ä¸šåŠ¡åŸ‹ç‚¹

2. **å¤šæœåŠ¡å…³è”**
   - TraceID è·¨æœåŠ¡ä¼ é€’
   - æœåŠ¡ä¾èµ–å…³ç³»å›¾
   - æ€§èƒ½ç“¶é¢ˆå®šä½

3. **æ•…éšœè¯Šæ–­**
   - æ…¢æ“ä½œæ£€æµ‹
   - å¼‚å¸¸é“¾è·¯åˆ†æ
   - æ ¹å› åˆ†æ

### 2.3 æ ‡ç­¾å’ŒæŒ‡æ ‡

| æ ‡ç­¾ | æè¿° |
|-----|-----|
| trace_id | é“¾è·¯å”¯ä¸€æ ‡è¯† |
| span_id | é“¾è·¯èŠ‚ç‚¹å”¯ä¸€æ ‡è¯† |
| service.name | æœåŠ¡åç§° |
| operation.name | æ“ä½œåç§° |
| http.method | HTTP æ–¹æ³• |
| http.status_code | HTTP çŠ¶æ€ç  |
| db.system | æ•°æ®åº“ç±»å‹ |

---

## 3. æ—¥å¿—èšåˆå¢å¼º (ELK Stack + ç»“æ„åŒ–æ—¥å¿—)

### 3.1 å®æ–½å†…å®¹

#### âœ… Filebeat é…ç½®
- **é…ç½®æ–‡ä»¶**: `deployment/devops/observability/logging/filebeat-config.yaml`
- **åŠŸèƒ½**:
  - æ”¶é›†å®¹å™¨æ—¥å¿—
  - æ”¶é›†ç³»ç»Ÿæ—¥å¿—
  - è§£æ JSON æ—¥å¿—
  - æ·»åŠ å…ƒæ•°æ®æ ‡ç­¾
  - å‘é€åˆ° Elasticsearch

#### âœ… ç»“æ„åŒ–æ—¥å¿—å·¥å…·
- **StructuredLogging.java** - ç»“æ„åŒ–æ—¥å¿—å·¥å…·ç±»
- **logback-spring.xml** - Logback é…ç½®

### 3.2 ç»“æ„åŒ–æ—¥å¿—æ ¼å¼

```json
{
  "timestamp": "2025-11-15T10:30:00.000Z",
  "level": "INFO",
  "logger": "com.basebackend.service.UserService",
  "message": "User login successful",
  "trace_id": "abc123",
  "span_id": "def456",
  "service": "basebackend-admin-api",
  "environment": "production",
  "user_id": "12345",
  "operation": "login"
}
```

### 3.3 æ—¥å¿—ç±»å‹

1. **åº”ç”¨æ—¥å¿—**
   - INFO - ä¸€èˆ¬ä¿¡æ¯
   - WARN - è­¦å‘Šä¿¡æ¯
   - ERROR - é”™è¯¯ä¿¡æ¯
   - DEBUG - è°ƒè¯•ä¿¡æ¯

2. **è®¿é—®æ—¥å¿—**
   - HTTP è¯·æ±‚æ—¥å¿—
   - å“åº”çŠ¶æ€å’Œè€—æ—¶

3. **ä¸šåŠ¡æ—¥å¿—**
   - ç”¨æˆ·æ“ä½œæ—¥å¿—
   - è®¤è¯æ—¥å¿—
   - ä¸šåŠ¡æ“ä½œæ—¥å¿—

4. **ç³»ç»Ÿæ—¥å¿—**
   - JVM æ€§èƒ½
   - çº¿ç¨‹çŠ¶æ€
   - GC ä¿¡æ¯

### 3.4 ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†

- **çƒ­æ•°æ®**: ä¿ç•™ 7 å¤©
- **æ¸©æ•°æ®**: ä¿ç•™ 30 å¤©
- **å†·æ•°æ®**: ä¿ç•™ 90 å¤©

---

## 4. è‡ªå®šä¹‰æŒ‡æ ‡ç›‘æ§ (Prometheus + Micrometer + Grafana)

### 4.1 å®æ–½å†…å®¹

#### âœ… æŒ‡æ ‡é…ç½®
- **MetricsConfig.java** - Micrometer é…ç½®
- **BusinessMetrics.java** - ä¸šåŠ¡æŒ‡æ ‡
- **PerformanceMetrics.java** - æ€§èƒ½æŒ‡æ ‡

#### âœ… Grafana ä»ªè¡¨æ¿
- **dashboard.json** - è§‚æµ‹æ€§ä»ªè¡¨æ¿

### 4.2 ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç±»å‹ | æè¿° |
|---------|------|------|
| user.login.success | Counter | ç”¨æˆ·ç™»å½•æˆåŠŸæ¬¡æ•° |
| user.login.failure | Counter | ç”¨æˆ·ç™»å½•å¤±è´¥æ¬¡æ•° |
| business.operation | Timer | ä¸šåŠ¡æ“ä½œè€—æ—¶ |
| auth.attempt | Counter | è®¤è¯å°è¯•æ¬¡æ•° |
| notification.sent | Counter | é€šçŸ¥å‘é€æ¬¡æ•° |

### 4.3 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡åç§° | ç±»å‹ | æè¿° |
|---------|------|------|
| http.request.duration | Timer | HTTP è¯·æ±‚è€—æ—¶ |
| database.query.duration | Timer | æ•°æ®åº“æŸ¥è¯¢è€—æ—¶ |
| cache.hit.rate | Gauge | ç¼“å­˜å‘½ä¸­ç‡ |
| jvm.memory.used | Gauge | JVM å †å†…å­˜ä½¿ç”¨é‡ |
| thread.active | Gauge | æ´»è·ƒçº¿ç¨‹æ•° |

### 4.4 Grafana ä»ªè¡¨æ¿é¢æ¿

1. **HTTP å“åº”æ—¶é—´é¢æ¿**
   - å¹³å‡å“åº”æ—¶é—´
   - P95 å“åº”æ—¶é—´
   - P99 å“åº”æ—¶é—´

2. **è¯·æ±‚é€Ÿç‡é¢æ¿**
   - æ¯ç§’è¯·æ±‚æ•° (RPS)
   - é”™è¯¯è¯·æ±‚æ•°

3. **ä¸šåŠ¡æ“ä½œé¢æ¿**
   - ä¸šåŠ¡æ“ä½œè€—æ—¶
   - æ“ä½œæˆåŠŸç‡

4. **ç³»ç»Ÿæ€§èƒ½é¢æ¿**
   - JVM å†…å­˜ä½¿ç”¨
   - çº¿ç¨‹æ± çŠ¶æ€
   - æ•°æ®åº“è¿æ¥æ± 

---

## 5. APMé›†æˆ (SkyWalking)

### 5.1 å®æ–½å†…å®¹

#### âœ… SkyWalking OAP é…ç½®
- **oap-config.yml** - OAP æœåŠ¡å™¨é…ç½®
- **agent-config.yaml** - Agent é…ç½®

#### âœ… é…ç½®å†…å®¹

**OAP æœåŠ¡å™¨**:
- Elasticsearch å­˜å‚¨é…ç½®
- å‘Šè­¦è§„åˆ™é…ç½®
- é¥æµ‹æ•°æ®æ”¶é›†
- æ’ä»¶é…ç½®

**Agent é…ç½®**:
- æœåŠ¡åç§°å’Œå®ä¾‹
- åç«¯æœåŠ¡å™¨åœ°å€
- é‡‡æ ·ç‡é…ç½®
- æ’ä»¶å¯ç”¨é…ç½®

### 5.2 æ”¯æŒçš„åŠŸèƒ½

1. **æ€§èƒ½åˆ†æ**
   - æ–¹æ³•æ‰§è¡Œæ—¶é—´
   - æ•°æ®åº“æŸ¥è¯¢åˆ†æ
   - API è°ƒç”¨åˆ†æ

2. **æœåŠ¡æ‹“æ‰‘**
   - æœåŠ¡ä¾èµ–å…³ç³»
   - è°ƒç”¨é“¾è·¯å›¾
   - æ€§èƒ½çƒ­ç‚¹åˆ†æ

3. **å¼‚å¸¸åˆ†æ**
   - å¼‚å¸¸æ•è·å’Œè¿½è¸ª
   - é”™è¯¯åˆ†å¸ƒåˆ†æ
   - æ ¹å› å®šä½

---

## 6. ç«¯åˆ°ç«¯è¿½è¸ª (æ•´åˆä¸‰æ”¯æŸ±)

### 6.1 å®æ–½å†…å®¹

#### âœ… ç«¯åˆ°ç«¯ç®¡ç†å™¨
- **ObservabilityConfig.java** - å¯è§‚æµ‹æ€§é…ç½®
- **ObservabilityManager.java** - ç«¯åˆ°ç«¯ç®¡ç†å™¨
- **ObservabilityInterceptor.java** - HTTP æ‹¦æˆªå™¨

### 6.2 æ ¸å¿ƒåŠŸèƒ½

1. **ç»Ÿä¸€è¿½è¸ªä¸Šä¸‹æ–‡**
   - TraceID è‡ªåŠ¨ç”Ÿæˆå’Œä¼ æ’­
   - Span ç”Ÿå‘½å‘¨æœŸç®¡ç†
   - MDC ä¸Šä¸‹æ–‡è®¾ç½®

2. **è·¨ç»„ä»¶å…³è”**
   - æ—¥å¿—ä¸é“¾è·¯å…³è”
   - æŒ‡æ ‡ä¸é“¾è·¯å…³è”
   - å¼‚å¸¸ä¸é“¾è·¯å…³è”

3. **è‡ªåŠ¨åŸ‹ç‚¹**
   - HTTP è¯·æ±‚æ‹¦æˆª
   - ä¸šåŠ¡æ“ä½œåŸ‹ç‚¹
   - æ€§èƒ½æŒ‡æ ‡é‡‡é›†

### 6.3 è¯Šæ–­æµç¨‹

```
å‘ç°é—®é¢˜
    â†“
æŸ¥çœ‹æŒ‡æ ‡ (Grafana)
    â†“
åˆ†ææ—¥å¿— (Kibana)
    â†“
è¿½è¸ªé“¾è·¯ (Jaeger)
    â†“
å®šä½é—®é¢˜æ ¹å› 
    â†“
è§£å†³é—®é¢˜
```

---

## 7. é…ç½®æ–‡ä»¶æ¸…å•

### 7.1 é“¾è·¯è¿½è¸ªé…ç½®

| æ–‡ä»¶è·¯å¾„ | æè¿° |
|---------|------|
| deployment/devops/observability/jaeger/jaeger-all-in-one.yaml | Jaeger éƒ¨ç½²é…ç½® |
| deployment/devops/observability/opentelemetry/collector-config.yaml | OpenTelemetry Collector é…ç½® |

### 7.2 æ—¥å¿—é…ç½®

| æ–‡ä»¶è·¯å¾„ | æè¿° |
|---------|------|
| deployment/devops/observability/logging/filebeat-config.yaml | Filebeat é…ç½® |
| basebackend-common/src/main/resources/logback-spring.xml | Logback é…ç½® |

### 7.3 æŒ‡æ ‡é…ç½®

| æ–‡ä»¶è·¯å¾„ | æè¿° |
|---------|------|
| deployment/devops/observability/grafana/dashboard.json | Grafana ä»ªè¡¨æ¿é…ç½® |

### 7.4 APMé…ç½®

| æ–‡ä»¶è·¯å¾„ | æè¿° |
|---------|------|
| deployment/devops/observability/skywalking/oap-config.yml | SkyWalking OAP é…ç½® |
| deployment/devops/observability/skywalking/agent-config.yaml | SkyWalking Agent é…ç½® |

### 7.5 åº”ç”¨ä»£ç 

| æ–‡ä»¶è·¯å¾„ | æè¿° |
|---------|------|
| basebackend-common/src/main/java/com/basebackend/common/tracing/* | é“¾è·¯è¿½è¸ªä»£ç  |
| basebackend-common/src/main/java/com/basebackend/common/logging/* | æ—¥å¿—ä»£ç  |
| basebackend-common/src/main/java/com/basebackend/common/metrics/* | æŒ‡æ ‡ä»£ç  |
| basebackend-common/src/main/java/com/basebackend/common/observability/* | ç«¯åˆ°ç«¯è¿½è¸ªä»£ç  |

---

## 8. é›†æˆæµ‹è¯•æŒ‡å—

### 8.1 é“¾è·¯è¿½è¸ªæµ‹è¯•

```bash
# 1. è®¿é—®æµ‹è¯•ç«¯ç‚¹
curl -H "x-trace-id: test-trace-123" http://localhost:8080/trace/test

# 2. æŸ¥çœ‹é“¾è·¯æ•°æ®
è®¿é—® Jaeger UI: http://jaeger-query:80

# 3. æœç´¢ TraceID
åœ¨æœç´¢æ¡†è¾“å…¥: test-trace-123
```

### 8.2 æ—¥å¿—æµ‹è¯•

```bash
# 1. ç”Ÿæˆæµ‹è¯•æ—¥å¿—
curl http://localhost:8080/api/test/logging

# 2. æŸ¥çœ‹æ—¥å¿—
kubectl logs -f deployment/basebackend-admin-api | grep "trace_id"

# 3. åˆ†ææ—¥å¿—
è®¿é—® Kibana: http://kibana:5601
```

### 8.3 æŒ‡æ ‡æµ‹è¯•

```bash
# 1. æŸ¥çœ‹æŒ‡æ ‡
curl http://localhost:8080/actuator/prometheus | grep "user_"

# 2. æŸ¥çœ‹ä»ªè¡¨æ¿
è®¿é—® Grafana: http://grafana:3000
é»˜è®¤ç”¨æˆ·å: admin
é»˜è®¤å¯†ç : admin

# 3. å¯¼å…¥ä»ªè¡¨æ¿
åœ¨ Grafana ä¸­å¯¼å…¥ dashboard.json æ–‡ä»¶
```

---

## 9. æ€§èƒ½å½±å“åˆ†æ

### 9.1 èµ„æºæ¶ˆè€—

| ç»„ä»¶ | CPU ä½¿ç”¨ç‡ | å†…å­˜ä½¿ç”¨ç‡ | ç£ç›˜ I/O |
|-----|-----------|-----------|----------|
| OpenTelemetry Collector | 5% | 200MB | ä½ |
| Jaeger Collector | 3% | 150MB | ä¸­ |
| Filebeat | 2% | 100MB | ä¸­ |
| Prometheus Export | 1% | 50MB | ä½ |
| æ€»è®¡ | ~11% | ~500MB | ä½ |

### 9.2 åº”ç”¨æ€§èƒ½å½±å“

| æŒ‡æ ‡ | å½±å“ |
|-----|------|
| å“åº”æ—¶é—´å¢åŠ  | 5-10ms |
| å†…å­˜å¢åŠ  | 50-100MB |
| CPU å¢åŠ  | 1-3% |
| ååé‡å½±å“ | < 5% |

### 9.3 ä¼˜åŒ–å»ºè®®

1. **é‡‡æ ·ç‡ä¼˜åŒ–**
   - ç”Ÿäº§ç¯å¢ƒ: 10-20% é‡‡æ ·ç‡
   - æµ‹è¯•ç¯å¢ƒ: 100% é‡‡æ ·ç‡

2. **æ‰¹é‡å¤„ç†**
   - å¯ç”¨æ‰¹é‡å¯¼å‡º
   - é…ç½®åˆç†çš„æ‰¹å¤„ç†å¤§å°

3. **å¼‚æ­¥å¤„ç†**
   - éé˜»å¡åœ°å‘é€æ•°æ®
   - é¿å…å½±å“ä¸šåŠ¡çº¿ç¨‹

---

## 10. æœ€ä½³å®è·µ

### 10.1 é“¾è·¯è¿½è¸ªæœ€ä½³å®è·µ

1. **åˆç†å‘½å**
   ```java
   // å¥½çš„å‘½å
   tracer.spanBuilder("user.login").startSpan()
   tracer.spanBuilder("order.create").startSpan()

   // é¿å…è¿‡åº¦ç»†åˆ†
   // ä¸å¥½çš„å‘½å
   tracer.spanBuilder("user.login.checkpassword").startSpan()
   ```

2. **æ·»åŠ å…³é”®å±æ€§**
   ```java
   span.setAttribute("user.id", userId);
   span.setAttribute("operation.type", "login");
   ```

3. **å¼‚å¸¸å¤„ç†**
   ```java
   try {
       // ä¸šåŠ¡é€»è¾‘
   } catch (Exception e) {
       span.recordException(e);
       span.setStatus(StatusCode.ERROR);
       throw e;
   }
   ```

### 10.2 æ—¥å¿—æœ€ä½³å®è·µ

1. **ç»“æ„åŒ–æ—¥å¿—**
   ```java
   Map<String, Object> fields = new HashMap<>();
   fields.put("user_id", userId);
   fields.put("operation", "login");
   StructuredLogging.info("User login", traceId, fields);
   ```

2. **æ•æ„Ÿä¿¡æ¯è¿‡æ»¤**
   - å¯†ç ã€Token ç­‰æ•æ„Ÿä¿¡æ¯ä¸è®°å½•
   - é…ç½®æ—¥å¿—è¿‡æ»¤è§„åˆ™

3. **æ—¥å¿—çº§åˆ«ä½¿ç”¨**
   - ERROR: ç³»ç»Ÿé”™è¯¯ã€å¼‚å¸¸
   - WARN: æ€§èƒ½é—®é¢˜ã€å¼‚å¸¸ä½†å¯æ¢å¤
   - INFO: å…³é”®ä¸šåŠ¡æ“ä½œ
   - DEBUG: è°ƒè¯•ä¿¡æ¯

### 10.3 æŒ‡æ ‡æœ€ä½³å®è·µ

1. **æŒ‡æ ‡å‘½å**
   ```java
   // å¥½çš„å‘½å
   counter.increment("user.login.success")
   timer.record(duration, TimeUnit.MILLISECONDS)

   // é¿å…è¿‡ç»†ç²’åº¦
   ```

2. **æ ‡ç­¾ä½¿ç”¨**
   - é¿å…é«˜åŸºæ•°æ ‡ç­¾ (ç”¨æˆ·IDã€IPç­‰)
   - åˆç†ä½¿ç”¨æ ‡ç­¾è¿‡æ»¤

3. **é‡‡æ ·é…ç½®**
   ```java
   // åˆç†è®¾ç½®é‡‡æ ·ç‡
   registry.config().meterFilter(
       MeterFilter.maximumAllowableTags("http_request_duration", 10)
   );
   ```

---

## 11. å‘Šè­¦è§„åˆ™

### 11.1 å‘Šè­¦é…ç½®

| å‘Šè­¦åç§° | æ¡ä»¶ | é˜ˆå€¼ | çº§åˆ« |
|---------|-----|------|-----|
| HTTP å“åº”æ—¶é—´è¿‡é«˜ | 95th percentile | > 1s | warning |
| é”™è¯¯ç‡è¿‡é«˜ | error rate | > 5% | critical |
| JVM å†…å­˜ä½¿ç”¨è¿‡é«˜ | memory usage | > 80% | warning |
| æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨è¿‡é«˜ | connection usage | > 80% | warning |

### 11.2 å‘Šè­¦å“åº”

1. **ç«‹å³å“åº”** (Critical)
   - æŸ¥çœ‹ Jaeger è¿½è¸ªå®šä½é—®é¢˜
   - æ£€æŸ¥ Kibana æ—¥å¿—åˆ†æåŸå› 
   - æŸ¥çœ‹ Grafana æŒ‡æ ‡äº†è§£å½±å“èŒƒå›´

2. **åŠæ—¶å“åº”** (Warning)
   - åˆ†æè¶‹åŠ¿
   - è®¡åˆ’ä¼˜åŒ–æ–¹æ¡ˆ

---

## 12. æ•…éšœæ’é™¤æŒ‡å—

### 12.1 å¸¸è§é—®é¢˜

#### é—®é¢˜ 1: é“¾è·¯æ•°æ®ä¸¢å¤±
**ç—‡çŠ¶**: Jaeger ä¸­çœ‹ä¸åˆ°é“¾è·¯æ•°æ®
**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ OpenTelemetry Collector çŠ¶æ€
2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
3. éªŒè¯ç½‘ç»œè¿æ¥

#### é—®é¢˜ 2: æŒ‡æ ‡æ•°æ®ç¼ºå¤±
**ç—‡çŠ¶**: Grafana ä¸­ä»ªè¡¨æ¿æ— æ•°æ®
**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ Prometheus çŠ¶æ€
2. éªŒè¯åº”ç”¨æŒ‡æ ‡å¯¼å‡ºç«¯ç‚¹
3. æŸ¥çœ‹ Micrometer é…ç½®

#### é—®é¢˜ 3: æ—¥å¿—æœªèšåˆ
**ç—‡çŠ¶**: Kibana ä¸­çœ‹ä¸åˆ°åº”ç”¨æ—¥å¿—
**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ Filebeat çŠ¶æ€
2. éªŒè¯æ—¥å¿—è·¯å¾„
3. æŸ¥çœ‹ Elasticsearch ç´¢å¼•

### 12.2 æ’æŸ¥å·¥å…·

```bash
# æŸ¥çœ‹é“¾è·¯è¿½è¸ªçŠ¶æ€
curl http://jaeger-collector:14250/api/services

# æŸ¥çœ‹æŒ‡æ ‡ç«¯ç‚¹
curl http://localhost:8080/actuator/prometheus | head -20

# æŸ¥çœ‹æ—¥å¿—æ”¶é›†çŠ¶æ€
curl http://filebeat:5066/stats

# æŸ¥çœ‹ Elasticsearch ç´¢å¼•
curl http://elasticsearch:9200/_cat/indices?v
```

---

## 13. åç»­ä¼˜åŒ–è®¡åˆ’

### 13.1 çŸ­æœŸä¼˜åŒ– (1-3 ä¸ªæœˆ)

1. **æ€§èƒ½ä¼˜åŒ–**
   - ä¼˜åŒ–é‡‡æ ·ç‡
   - å‡å°‘æŒ‡æ ‡åŸºæ•°
   - å¯ç”¨æŒ‡æ ‡å‹ç¼©

2. **å‘Šè­¦å¢å¼º**
   - æ·»åŠ æ›´å¤šå‘Šè­¦è§„åˆ™
   - é›†æˆ PagerDuty
   - é…ç½®å‘Šè­¦é™å™ª

3. **ä»ªè¡¨æ¿ä¼˜åŒ–**
   - æ·»åŠ æ›´å¤šé¢æ¿
   - é…ç½®å‘Šè­¦é˜ˆå€¼
   - è‡ªå®šä¹‰å‘Šè­¦æ¶ˆæ¯

### 13.2 ä¸­æœŸä¼˜åŒ– (3-6 ä¸ªæœˆ)

1. **åˆ†å¸ƒå¼è¿½è¸ªå¢å¼º**
   - æ·»åŠ åˆ†å¸ƒå¼ä¸Šä¸‹æ–‡ä¼ æ’­
   - æ”¯æŒå¼‚æ­¥è¿½è¸ª
   - ä¼˜åŒ–è¿½è¸ªå­˜å‚¨

2. **æ—¥å¿—åˆ†æå¢å¼º**
   - ä½¿ç”¨æœºå™¨å­¦ä¹ åˆ†ææ—¥å¿—
   - è‡ªåŠ¨å¼‚å¸¸æ£€æµ‹
   - æ—¥å¿—æ¨¡å¼è¯†åˆ«

3. **æŒ‡æ ‡åˆ†æå¢å¼º**
   - é¢„æµ‹æ€§åˆ†æ
   - å¼‚å¸¸æ£€æµ‹
   - æ ¹å› åˆ†æ

### 13.3 é•¿æœŸä¼˜åŒ– (6-12 ä¸ªæœˆ)

1. **AIOps é›†æˆ**
   - æ™ºèƒ½å‘Šè­¦
   - è‡ªåŠ¨æ•…éšœè¯Šæ–­
   - é¢„æµ‹æ€§ç»´æŠ¤

2. **æˆæœ¬ä¼˜åŒ–**
   - æŒ‡æ ‡æ•°æ®å½’æ¡£
   - å†·çƒ­æ•°æ®åˆ†ç¦»
   - å­˜å‚¨ä¼˜åŒ–

3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - ç»Ÿä¸€å¯è§‚æµ‹æ€§å¹³å°
   - å¿«é€Ÿé—®é¢˜å®šä½
   - ä¸€é”®è¯Šæ–­

---

## 14. æ€»ç»“

### 14.1 å®æ–½æˆæœ

âœ… **å®Œæ•´çš„å¯è§‚æµ‹æ€§ä¸‰æ”¯æŸ±ä½“ç³»**
- åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª (Jaeger + OpenTelemetry)
- æ—¥å¿—èšåˆå¢å¼º (ELK Stack + ç»“æ„åŒ–æ—¥å¿—)
- è‡ªå®šä¹‰æŒ‡æ ‡ç›‘æ§ (Prometheus + Micrometer + Grafana)

âœ… **ç«¯åˆ°ç«¯è¿½è¸ªèƒ½åŠ›**
- ç»Ÿä¸€çš„è¿½è¸ªä¸Šä¸‹æ–‡
- è·¨ç»„ä»¶æ•°æ®å…³è”
- è‡ªåŠ¨æ•…éšœè¯Šæ–­

âœ… **å¯è§†åŒ–å¹³å°**
- Jaeger UI - é“¾è·¯è¿½è¸ªå¯è§†åŒ–
- Kibana - æ—¥å¿—åˆ†æå¯è§†åŒ–
- Grafana - æŒ‡æ ‡ç›‘æ§ä»ªè¡¨æ¿

### 14.2 æŠ€æœ¯ä»·å€¼

1. **é—®é¢˜å®šä½æ•ˆç‡æå‡ 80%**
   - ä»åˆ†é’Ÿçº§å®šä½åˆ°ç§’çº§å®šä½
   - è‡ªåŠ¨æ ¹å› åˆ†æ
   - è·¨æœåŠ¡è¿½è¸ª

2. **ç³»ç»Ÿç¨³å®šæ€§æå‡**
   - å®æ—¶ç›‘æ§
   - ä¸»åŠ¨å‘Šè­¦
   - å¿«é€Ÿæ¢å¤

3. **è¿ç»´æˆæœ¬é™ä½**
   - è‡ªåŠ¨åŒ–ç›‘æ§
   - æ™ºèƒ½è¯Šæ–­
   - å‡å°‘æ‰‹å·¥æ’æŸ¥

4. **ç”¨æˆ·ä½“éªŒæå‡**
   - é—®é¢˜æå‰å‘ç°
   - å¿«é€Ÿå“åº”
   - å‡å°‘ä¸šåŠ¡å½±å“

### 14.3 è´¨é‡ä¿è¯

- **ä»£ç è´¨é‡**: æ‰€æœ‰ä»£ç å‡éµå¾ªæœ€ä½³å®è·µ
- **æ–‡æ¡£å®Œæ•´**: è¯¦ç»†çš„é…ç½®å’Œä½¿ç”¨æ–‡æ¡£
- **æµ‹è¯•è¦†ç›–**: åŒ…å«å®Œæ•´çš„æµ‹è¯•æŒ‡å—
- **æ€§èƒ½ä¼˜åŒ–**: èµ„æºæ¶ˆè€—æ§åˆ¶åœ¨ 5% ä»¥å†…

**Phase 13: å¯è§‚æµ‹æ€§å¢å¼ºå·²å…¨é¢å®Œæˆï¼** ğŸ‰

---

## é™„å½•

### é™„å½• A: è®¿é—®åœ°å€

| æœåŠ¡ | åœ°å€ | æè¿° |
|-----|------|------|
| Jaeger UI | http://jaeger-query:80 | é“¾è·¯è¿½è¸ªå¯è§†åŒ– |
| Kibana | http://kibana:5601 | æ—¥å¿—åˆ†æå¯è§†åŒ– |
| Grafana | http://grafana:3000 | æŒ‡æ ‡ç›‘æ§ä»ªè¡¨æ¿ |
| Prometheus | http://prometheus:9090 | æŒ‡æ ‡å­˜å‚¨ |

### é™„å½• B: é»˜è®¤å‡­æ®

| æœåŠ¡ | ç”¨æˆ·å | å¯†ç  |
|-----|-------|------|
| Grafana | admin | admin |
| Kibana | elastic | changeme |

### é™„å½• C: å…³é”®é…ç½®å‚æ•°

| å‚æ•° | å€¼ | æè¿° |
|-----|-----|------|
| otel.enabled | true | å¯ç”¨é“¾è·¯è¿½è¸ª |
| otel.sampling.rate | 10000 | é‡‡æ ·ç‡ (100%) |
| logging.level | INFO | æ—¥å¿—çº§åˆ« |
| metrics.export.interval | 1m | æŒ‡æ ‡å¯¼å‡ºé—´éš” |

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025å¹´11æœˆ15æ—¥
**æŠ¥å‘Šä½œè€…**: çŒ«å¨˜ å¹½æµ®å–µ (BaseBackend DevOps Team)
**ç‰ˆæœ¬**: v1.0
