server:
  port: 8082

spring:
  application:
    name: admin-api
  profiles:
    active: dev,observability,messaging,nacos

# MyBatis Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    call-setters-on-nulls: true
    jdbc-type-for-null: 'null'
  global-config:
    db-config:
      id-type: ASSIGN_ID
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
  mapper-locations: classpath*:mapper/**/*.xml

# 日志配置
logging:
  level:
    com.basebackend.admin: debug
    org.springframework.security: debug
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"

# Knife4j配置
knife4j:
  enable: true
  openapi:
    title: 后台管理系统API
    description: 基于RBAC权限模型的后台管理系统
    version: 1.0.0
    concat: admin@basebackend.com
  setting:
    language: zh_cn
    enable-version: true
    enable-swagger-models: true
    enable-document-manage: true
    swagger-model-name: 实体类列表

    # 邮件配置（用于告警）
    mail:
      host: smtp.example.com
      port: 587
      username: alert@example.com
      password: your-password
      properties:
        mail:
          smtp:
            auth: true
            starttls:
              enable: true

  # 日志配置
  logging:
    config: classpath:logback-structured.xml
    structured:
      enabled: true
      loki-enabled: true
      loki-url: http://localhost:3100/loki/api/v1/push

  # Actuator 配置
  management:
    endpoints:
      web:
        exposure:
          include: health,info,metrics,prometheus
    metrics:
      export:
        prometheus:
          enabled: true
    tracing:
      sampling:
        probability: 1.0  # 100% 采样（生产环境建议降低到 0.1）

  # 可观测性配置
  observability:
    # Prometheus 地址
    prometheus:
      url: http://localhost:9190

    # Loki 地址
    loki:
      url: http://localhost:3100

    # Tempo 配置
    tempo:
      enabled: true
      endpoint: http://localhost:9411/api/v2/spans
      query-url: http://localhost:3200

    # 告警配置
    alert:
      # 邮件告警
      email:
        enabled: true
        from: alert@example.com
        to: admin@example.com

      # 钉钉告警
      dingtalk:
        enabled: false
        webhook: https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN
        secret: YOUR_SECRET

      # 企业微信告警
      wechat:
        enabled: false
        webhook: https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY